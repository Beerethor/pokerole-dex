<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scheda Allenatore - ProDex</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --pk-red: #e74c3c; --pk-blue: #d6eaf8; --pk-gray: #bdc3c7; }
        body { background-color: #0f172a; font-family: 'JetBrains Mono', monospace; color: white; opacity: 0; transition: opacity 0.5s; }
        body.auth-ready { opacity: 1; }

        /* STILE SCHEDA FEDELE ALL'IMMAGINE */
        .trainer-card-ui {
            background-color: #d1d5db;
            border-radius: 20px;
            overflow: hidden;
            width: 100%;
            max-width: 850px;
            margin: 20px auto;
            border: 4px solid #9ca3af;
            color: #333;
            position: relative;
        }
        .card-header {
            background-color: var(--pk-red);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 8px solid #c0392b;
        }
        .header-title { font-family: 'Orbitron'; font-weight: 900; color: white; font-size: 1.8rem; letter-spacing: 2px; }
        
        .photo-frame {
            background: white;
            border: 4px solid #4b5563;
            border-radius: 15px;
            width: 200px;
            height: 250px;
            object-cover: cover;
        }

        .data-field {
            background-color: var(--pk-blue);
            border-radius: 8px;
            padding: 4px 10px;
            border: 2px solid #333;
            font-weight: bold;
            color: #1e293b;
            min-height: 24px;
        }
        .label-text { font-family: 'Orbitron'; font-size: 0.65rem; font-weight: 900; color: #111; text-transform: uppercase; }
        
        /* Input Form */
        .admin-panel { background: #1e293b; border: 1px solid #3b82f6; border-radius: 15px; padding: 20px; margin-bottom: 30px; }
        .admin-input { background: #0f172a; color: #38bdf8; border: 1px solid #334155; padding: 5px 10px; border-radius: 5px; font-size: 12px; width: 100%; }
        
        /* Statistiche a pallini */
        .dot { width: 8px; height: 8px; border-radius: 50%; border: 1px solid #333; background: white; }
        .dot.filled { background: #333; }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-5xl mx-auto">
        <div class="flex justify-between items-center mb-6">
            <a href="index.html" class="bg-white/10 hover:bg-red-600 px-4 py-2 rounded-lg text-xs font-black uppercase transition-all">⬅ Torna alla Home</a>
            <button onclick="toggleForm()" class="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded-lg text-xs font-black uppercase">➕ Crea Nuovo Allenatore</button>
        </div>

        <div id="trainer-form" class="hidden admin-panel">
            <h2 class="text-blue-400 font-black mb-4 uppercase tracking-tighter">Nuovo Record Database</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="space-y-2">
                    <label class="label-xs text-white">Foto & Base</label>
                    <input type="file" id="f-img" onchange="encodeImg()" class="admin-input">
                    <input type="text" id="f-name" placeholder="Nome" class="admin-input">
                    <input type="text" id="f-rank" placeholder="Rank (es. Starter)" class="admin-input">
                    <input type="number" id="f-age" placeholder="Età" class="admin-input">
                    <input type="text" id="f-player" placeholder="Giocatore" class="admin-input">
                </div>
                <div class="space-y-2">
                    <label class="label-xs text-white">Personalità</label>
                    <input type="text" id="f-concept" placeholder="Concept" class="admin-input">
                    <input type="text" id="f-nature" placeholder="Natura" class="admin-input">
                    <input type="number" id="f-conf" placeholder="Confidence" class="admin-input">
                    <input type="text" id="f-money" placeholder="Money ($)" class="admin-input">
                    <div class="flex gap-2">
                        <input type="number" id="f-hp" placeholder="HP" class="admin-input">
                        <input type="number" id="f-will" placeholder="WILL" class="admin-input">
                    </div>
                </div>
                <div class="space-y-2">
                    <label class="label-xs text-white">Attributi (1-5)</label>
                    <input type="number" id="f-str" placeholder="Strength" class="admin-input">
                    <input type="number" id="f-dex" placeholder="Dexterity" class="admin-input">
                    <input type="number" id="f-vit" placeholder="Vitality" class="admin-input">
                    <input type="number" id="f-ins" placeholder="Insight" class="admin-input">
                </div>
                <div class="space-y-2">
                    <label class="label-xs text-white">Zaino & Progressi</label>
                    <textarea id="f-bag" placeholder="Zaino (es. Potion x2...)" class="admin-input" rows="3"></textarea>
                    <input type="text" id="f-seen" placeholder="Catturati (es. 10/150)" class="admin-input">
                    <button onclick="saveToFirebase()" class="bg-green-600 w-full py-2 rounded font-black text-white mt-2">SALVA</button>
                </div>
            </div>
        </div>

        <div id="cards-container" class="space-y-10"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA7Xb8BbyL9s7buH_BW0hx2exD5Tb5G-pk",
            authDomain: "pokerole-app.firebaseapp.com",
            projectId: "pokerole-app",
            storageBucket: "pokerole-app.firebasestorage.app",
            messagingSenderId: "385416519668",
            appId: "1:385416519668:web:908e12b9833f1cdc04a3a1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let base64Img = "";

        // PROTEZIONE PAGINA
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = 'index.html';
                return;
            }
            currentUser = user;
            document.body.classList.add('auth-ready');
            loadData();
        });

        window.toggleForm = () => document.getElementById('trainer-form').classList.toggle('hidden');

        window.encodeImg = () => {
            const file = document.getElementById('f-img').files[0];
            const reader = new FileReader();
            reader.onloadend = () => { base64Img = reader.result; };
            reader.readAsDataURL(file);
        };

        window.saveToFirebase = async () => {
            const data = {
                id: Date.now(),
                img: base64Img || "https://api.dicebear.com/7.x/bottts/svg?seed=Trainer",
                name: document.getElementById('f-name').value,
                rank: document.getElementById('f-rank').value,
                age: document.getElementById('f-age').value,
                player: document.getElementById('f-player').value,
                concept: document.getElementById('f-concept').value,
                nature: document.getElementById('f-nature').value,
                conf: document.getElementById('f-conf').value,
                money: document.getElementById('f-money').value,
                hp: document.getElementById('f-hp').value,
                will: document.getElementById('f-will').value,
                bag: document.getElementById('f-bag').value,
                seen: document.getElementById('f-seen').value,
                stats: {
                    str: document.getElementById('f-str').value,
                    dex: document.getElementById('f-dex').value,
                    vit: document.getElementById('f-vit').value,
                    ins: document.getElementById('f-ins').value
                }
            };

            await updateDoc(doc(db, "Users", currentUser.uid), {
                allenatori_generati: arrayUnion(data)
            });
            location.reload();
        };

        async function loadData() {
            const snap = await getDoc(doc(db, "Users", currentUser.uid));
            if (snap.exists() && snap.data().allenatori_generati) {
                const list = snap.data().allenatori_generati;
                document.getElementById('cards-container').innerHTML = list.map(t => renderCard(t)).join('');
            }
        }

        function renderCard(t) {
            const drawDots = (val) => {
                let html = '<div class="flex gap-1">';
                for(let i=1; i<=5; i++) html += `<div class="dot ${i <= val ? 'filled' : ''}"></div>`;
                return html + '</div>';
            };

            return `
            <div class="trainer-card-ui">
                <div class="card-header">
                    <div class="header-title">POKÉMON LEAGUE</div>
                    <div class="flex flex-col items-end">
                        <span class="text-[10px] text-white/80 font-bold uppercase">Trainer's Card Rank:</span>
                        <div class="data-field min-w-[120px] text-center">${t.rank}</div>
                    </div>
                </div>

                <div class="p-6 grid grid-cols-12 gap-6">
                    <div class="col-span-12 md:col-span-4 space-y-4">
                        <img src="${t.img}" class="photo-frame">
                        <div class="space-y-2">
                            <div class="flex items-center gap-2">
                                <div class="bg-gray-800 text-white px-2 py-1 rounded font-black text-xs">HP</div>
                                <div class="data-field flex-1">${t.hp}</div>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="bg-gray-800 text-white px-2 py-1 rounded font-black text-xs">WILL</div>
                                <div class="data-field flex-1">${t.will}</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-span-12 md:col-span-8 space-y-4">
                        <div class="grid grid-cols-3 gap-2">
                            <div class="col-span-2"><span class="label-text">Name:</span><div class="data-field uppercase">${t.name}</div></div>
                            <div><span class="label-text">Age:</span><div class="data-field">${t.age}</div></div>
                            <div class="col-span-1"><span class="label-text">Player:</span><div class="data-field">${t.player}</div></div>
                            <div class="col-span-2"><span class="label-text">Concept:</span><div class="data-field">${t.concept}</div></div>
                            <div class="col-span-2"><span class="label-text">Nature:</span><div class="data-field">${t.nature}</div></div>
                            <div><span class="label-text">Money:</span><div class="data-field">$ ${t.money}</div></div>
                        </div>

                        <div class="bg-gray-400/20 p-4 rounded-xl border-2 border-gray-400">
                             <span class="label-text">Attributes & Skills (Pag. 2)</span>
                             <div class="grid grid-cols-2 gap-x-8 gap-y-2 mt-2">
                                <div class="flex justify-between items-center"><span class="text-[10px] font-bold">STRENGTH</span> ${drawDots(t.stats.str)}</div>
                                <div class="flex justify-between items-center"><span class="text-[10px] font-bold">DEXTERITY</span> ${drawDots(t.stats.dex)}</div>
                                <div class="flex justify-between items-center"><span class="text-[10px] font-bold">VITALITY</span> ${drawDots(t.stats.vit)}</div>
                                <div class="flex justify-between items-center"><span class="text-[10px] font-bold">INSIGHT</span> ${drawDots(t.stats.ins)}</div>
                             </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div><span class="label-text">Backpack:</span><div class="data-field text-[10px] h-20 overflow-auto">${t.bag}</div></div>
                            <div><span class="label-text">Pokedex:</span><div class="data-field text-center py-4 text-xl">${t.seen}</div></div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-400 p-2 flex justify-center gap-4">
                    ${Array.from({length:8}).map((_,i)=>`<div class="w-8 h-8 rounded-full bg-white border border-gray-600 flex items-center justify-center text-[8px] font-black">${i+1}</div>`).join('')}
                    <span class="label-text self-center">Gym Badges</span>
                </div>
            </div>`;
        }
    </script>
</body>
</html>
