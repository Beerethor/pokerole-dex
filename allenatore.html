<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural ProDex - Full Trainer Sheet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --pokedex-red: #ef4444; --bg-dark: #020617; }
        body { background-color: var(--bg-dark); font-family: 'JetBrains Mono', monospace; color: white; }
        
        /* Estetica Scheda PDF */
        .trainer-sheet { 
            background: #e2e8f0; color: #1e293b; border-radius: 20px; 
            padding: 20px; border: 4px solid #94a3b8; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            max-width: 800px; margin: auto;
        }
        .header-card { background: #ef4444; color: white; border-radius: 15px 15px 0 0; padding: 10px; font-family: 'Orbitron'; }
        .label-sm { font-size: 0.55rem; font-weight: 800; text-transform: uppercase; color: #475569; display: block; }
        .stat-box { background: #cbd5e1; padding: 4px; border-radius: 6px; border-bottom: 2px solid #94a3b8; }
        
        /* Form Inputs */
        input, select, textarea { 
            background: #1e293b; border: 1px solid #334155; border-radius: 6px; 
            padding: 8px; width: 100%; color: white; font-size: 12px;
        }
        .section-title { color: #ef4444; font-weight: 900; font-size: 10px; border-bottom: 1px solid #334155; margin-bottom: 10px; padding-top: 15px; }
    </style>
</head>
<body class="p-4">

    <div class="max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-8 border-b border-white/10 pb-4">
            <h1 class="text-3xl font-black font-[Orbitron] italic uppercase">Trainer <span class="text-red-500">Registry</span></h1>
            <div class="flex gap-2">
                <button onclick="showNewTrainerForm()" class="bg-blue-600 px-4 py-2 rounded-lg font-black uppercase text-[10px]">Aggiungi Operatore</button>
                <a href="index.html" class="bg-white/10 px-4 py-2 rounded-lg text-[10px] font-black uppercase">Hub</a>
            </div>
        </header>

        <div id="trainer-form" class="hidden mb-10 bg-slate-900/80 p-6 rounded-2xl border border-white/10">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                
                <div class="space-y-3">
                    <div class="h-40 bg-slate-800 rounded-xl border-2 border-dashed border-slate-600 flex items-center justify-center relative overflow-hidden">
                        <img id="preview-img" class="absolute inset-0 w-full h-full object-cover hidden">
                        <input type="file" id="t-file" onchange="previewFile()" class="absolute inset-0 opacity-0 cursor-pointer">
                        <span class="text-[8px] text-slate-500 uppercase">Foto</span>
                    </div>
                    <input type="text" id="t-name" placeholder="NOME">
                    <input type="number" id="t-age" placeholder="ANNI">
                    <select id="t-rank">
                        <option>Starter</option><option>Beginner</option><option>Amateur</option><option>Ace</option><option>Pro</option><option>Master</option>
                    </select>
                </div>

                <div class="space-y-3">
                    <div class="section-title">Personalità</div>
                    <input type="text" id="t-nature" placeholder="NATURA">
                    <input type="number" id="t-confidence" placeholder="CONFIDENCE">
                    <input type="number" id="t-money" placeholder="MONEY ($)">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="s-hp" placeholder="HP">
                        <input type="number" id="s-will" placeholder="WILL">
                    </div>
                </div>

                <div class="space-y-3">
                    <div class="section-title">Attributi (1-5)</div>
                    <input type="number" id="s-str" placeholder="STRENGTH" max="5">
                    <input type="number" id="s-dex" placeholder="DEXTERITY" max="5">
                    <input type="number" id="s-vit" placeholder="VITALITY" max="5">
                    <input type="number" id="s-ins" placeholder="INSIGHT" max="5">
                </div>

                <div class="space-y-3">
                    <div class="section-title">Specialità (0-5)</div>
                    <input type="number" id="sk-allure" placeholder="ALLURE (Social)">
                    <input type="number" id="sk-lore" placeholder="LORE (Knowledge)">
                    <input type="number" id="sk-brawl" placeholder="BRAWL (Fight)">
                    <textarea id="t-backpack" placeholder="ZAINO (Pozioni, Strumenti...)" rows="3"></textarea>
                </div>
            </div>
            <button onclick="saveTrainer()" class="w-full mt-6 bg-red-600 py-3 rounded-xl font-black uppercase text-xs">Sincronizza nel Cloud</button>
        </div>

        <div id="trainer-list" class="space-y-10"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA7Xb8BbyL9s7buH_BW0hx2exD5Tb5G-pk",
            authDomain: "pokerole-app.firebaseapp.com",
            projectId: "pokerole-app",
            storageBucket: "pokerole-app.firebasestorage.app",
            messagingSenderId: "385416519668",
            appId: "1:385416519668:web:908e12b9833f1cdc04a3a1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let base64Image = null;

        window.showNewTrainerForm = () => document.getElementById('trainer-form').classList.toggle('hidden');

        window.previewFile = () => {
            const file = document.getElementById('t-file').files[0];
            const reader = new FileReader();
            reader.onloadend = () => {
                base64Image = reader.result;
                const img = document.getElementById('preview-img');
                img.src = base64Image;
                img.classList.remove('hidden');
            };
            if (file) reader.readAsDataURL(file);
        };

        window.saveTrainer = async () => {
            if (!currentUser) return;
            const trainerData = {
                id: Date.now(),
                nome: document.getElementById('t-name').value,
                rango: document.getElementById('t-rank').value,
                anni: document.getElementById('t-age').value,
                natura: document.getElementById('t-nature').value,
                confidence: document.getElementById('t-confidence').value,
                money: document.getElementById('t-money').value,
                hp: document.getElementById('s-hp').value,
                will: document.getElementById('s-will').value,
                zaino: document.getElementById('t-backpack').value,
                immagine: base64Image || "https://api.dicebear.com/7.x/pixel-art/svg",
                stats: {
                    strength: document.getElementById('s-str').value,
                    dexterity: document.getElementById('s-dex').value,
                    vitality: document.getElementById('s-vit').value,
                    insight: document.getElementById('s-ins').value,
                },
                skills: {
                    allure: document.getElementById('sk-allure').value,
                    lore: document.getElementById('sk-lore').value,
                    brawl: document.getElementById('sk-brawl').value
                }
            };

            const userRef = doc(db, "Users", currentUser.uid);
            await updateDoc(userRef, { allenatori_generati: arrayUnion(trainerData) });
            location.reload();
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                const snap = await getDoc(doc(db, "Users", user.uid));
                if (snap.exists() && snap.data().allenatori_generati) renderTrainers(snap.data().allenatori_generati);
            }
        });

        function renderTrainers(list) {
            document.getElementById('trainer-list').innerHTML = list.map(t => `
                <div class="trainer-sheet">
                    <div class="header-card flex justify-between px-4">
                        <span class="text-[9px] font-black uppercase">Pokémon League Card</span>
                        <span class="text-[9px] font-bold">RANGO: ${t.rango}</span>
                    </div>
                    <div class="grid grid-cols-12 gap-4 mt-4">
                        <div class="col-span-4 space-y-2">
                            <img src="${t.immagine}" class="w-full h-44 object-cover rounded-lg border-2 border-slate-400">
                            <div class="flex gap-2">
                                <div class="stat-box flex-1 text-center"><span class="label-sm">HP</span><div class="font-black">${t.hp}</div></div>
                                <div class="stat-box flex-1 text-center"><span class="label-sm">WILL</span><div class="font-black">${t.will}</div></div>
                            </div>
                            <div class="stat-box text-center"><span class="label-sm">MONEY</span><div class="font-black">$ ${t.money}</div></div>
                        </div>
                        <div class="col-span-8">
                            <div class="grid grid-cols-2 border-b border-slate-400 mb-2">
                                <div><span class="label-sm">Name:</span><div class="font-black uppercase">${t.nome}</div></div>
                                <div><span class="label-sm">Age:</span><div class="font-bold">${t.anni}</div></div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <span class="label-sm">Nature:</span><div class="text-[10px] font-bold uppercase mb-2">${t.natura}</div>
                                    <span class="label-sm">Confidence:</span><div class="font-bold mb-4">${t.confidence} / 5</div>
                                    <span class="label-sm">Backpack:</span><div class="text-[9px] bg-white/50 p-2 rounded h-20 overflow-auto italic">"${t.zaino}"</div>
                                </div>
                                <div class="space-y-1">
                                    <span class="label-sm">Main Attributes:</span>
                                    ${Object.entries(t.stats).map(([k, v]) => `
                                        <div class="flex justify-between items-center text-[9px] bg-slate-300 p-1 rounded">
                                            <span class="font-bold uppercase">${k}</span>
                                            <div class="flex gap-0.5">${Array.from({length:5}).map((_,i)=>`<div class="w-1.5 h-1.5 rounded-full ${i<v?'bg-slate-800':'bg-white'}"></div>`).join('')}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 flex gap-2 overflow-x-auto pb-2">
                        ${Array.from({length:8}).map((_,i)=>`<div class="w-8 h-8 rounded-full border-2 border-slate-400 flex items-center justify-center text-[8px] text-slate-400 font-bold">${i+1}</div>`).join('')}
                        <span class="label-sm self-center ml-2">Gym Badges</span>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
