<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trainer Database - Neural ProDex</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --pk-red: #dc2626; --pk-blue: #d6eaf8; --bg-dark: #020617; }
        body { background-color: var(--bg-dark); font-family: 'JetBrains Mono', monospace; color: white; opacity: 0; transition: opacity 0.5s; }
        body.auth-ready { opacity: 1; }

        .preview-card {
            background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px; overflow: hidden; cursor: pointer; transition: all 0.3s ease;
        }
        .preview-card:hover { transform: translateY(-5px); border-color: #ef4444; background: rgba(255,255,255,0.1); }
        .preview-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; object-position: top; border-bottom: 2px solid rgba(255,255,255,0.1); }

        .trainer-card-ui {
            background-color: #d1d5db; border-radius: 12px; overflow: hidden;
            width: 100%; max-width: 1100px; margin: 20px auto;
            border: 6px solid #334155; color: #1e293b; display: none;
        }
        .trainer-card-ui.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        .card-header { background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%); padding: 12px 25px; display: flex; justify-content: space-between; align-items: center; border-bottom: 6px solid #991b1b; }
        .data-field { background-color: var(--pk-blue); border-radius: 4px; padding: 2px 8px; border: 2px solid #1e293b; font-weight: 800; color: #1e293b; font-size: 11px; }
        .label-text { font-family: 'Orbitron'; font-size: 0.55rem; font-weight: 900; color: #111; text-transform: uppercase; display: block; }
        .photo-container { background: white; border: 4px solid #1e293b; border-radius: 4px; width: 100%; height: 450px; overflow: hidden; }
        .photo-container img { width: 100%; height: 100%; object-fit: cover; object-position: top; }

        .dot { width: 7px; height: 7px; border-radius: 50%; border: 1px solid #1e293b; background: white; }
        .dot.filled { background: #1e293b; }
        .skill-row { display: flex; justify-content: space-between; align-items: center; font-size: 9px; font-weight: 800; padding: 1px 0; border-bottom: 1px solid rgba(0,0,0,0.1); }
        .admin-panel { background: #1e293b; border: 2px solid #3b82f6; border-radius: 15px; padding: 20px; margin-bottom: 30px; }
        
        input, select, textarea { background: #0f172a !important; color: #38bdf8 !important; border: 1px solid #334155 !important; padding: 4px; border-radius: 4px; font-size: 11px; width: 100%; }
        input[type="number"]::-webkit-inner-spin-button { opacity: 1; }
    </style>
</head>
<body class="p-4 md:p-6">

    <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-10">
            <h1 class="text-3xl font-black italic font-[Orbitron]">NEURAL <span class="text-red-500">PRODEX</span></h1>
            <div class="flex gap-2">
                <a href="index.html" class="bg-white/10 hover:bg-white/20 px-4 py-2 rounded text-xs font-black uppercase border border-white/10">üè† Home</a>
                <button onclick="toggleForm()" class="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded text-xs font-black uppercase shadow-lg shadow-blue-900/50">‚ûï Nuovo Allenatore</button>
            </div>
        </div>

        <div id="trainer-form" class="hidden admin-panel text-[10px]">
             <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                <div>
                    <label class="text-blue-300 font-bold uppercase">Identit√†</label>
                    <input type="file" id="f-img" onchange="encodeImg()" class="mb-1">
                    <input type="text" id="f-name" placeholder="Nome Personaggio">
                    <input type="text" id="f-rank" placeholder="Rango">
                    <input type="number" id="f-age" min="0" placeholder="Anni">
                    <input type="text" id="f-nature" placeholder="Natura">
                    <input type="number" id="f-conf" min="0" max="5" placeholder="Confidence (0-5)">
                    <input type="number" id="f-money" min="0" placeholder="Soldi ($)">
                </div>
                <div>
                    <label class="text-blue-300 font-bold uppercase">Skill Fisiche (0-5)</label>
                    <input type="number" id="s-rissa" min="0" max="5" placeholder="Rissa"><input type="number" id="s-lancio" min="0" max="5" placeholder="Lancio">
                    <input type="number" id="s-evas" min="0" max="5" placeholder="Evasione"><input type="number" id="s-armi" min="0" max="5" placeholder="Armi">
                    <input type="number" id="s-allerta" min="0" max="5" placeholder="Allerta"><input type="number" id="s-atle" min="0" max="5" placeholder="Atletica">
                    <input type="number" id="s-nat" min="0" max="5" placeholder="Natura"><input type="number" id="s-furt" min="0" max="5" placeholder="Furtivit√†">
                </div>
                <div>
                    <label class="text-blue-300 font-bold uppercase">Skill Mentali (0-5)</label>
                    <input type="number" id="s-fasc" min="0" max="5" placeholder="Fascino"><input type="number" id="s-etich" min="0" max="5" placeholder="Etichetta">
                    <input type="number" id="s-intim" min="0" max="5" placeholder="Intimidire"><input type="number" id="s-prest" min="0" max="5" placeholder="Prestazione">
                    <input type="number" id="s-creaz" min="0" max="5" placeholder="Creazione"><input type="number" id="s-storia" min="0" max="5" placeholder="Storia">
                    <input type="number" id="s-med" min="0" max="5" placeholder="Medicina"><input type="number" id="s-scienza" min="0" max="5" placeholder="Scienza">
                </div>
                <div>
                    <label class="text-blue-300 font-bold uppercase">Attr. & Virt√π</label>
                    <input type="number" id="f-str" min="0" placeholder="Forza"><input type="number" id="f-dex" min="0" placeholder="Destrezza">
                    <input type="number" id="f-vit" min="0" placeholder="Vitalit√†"><input type="number" id="f-ins" min="0" placeholder="Istinto">
                    <div class="my-1 border-t border-white/10"></div>
                    <input type="number" id="v-grinta" min="0" max="5" placeholder="Grinta"><input type="number" id="v-classe" min="0" max="5" placeholder="Classe">
                    <input type="number" id="v-bellezza" min="0" max="5" placeholder="Bellezza"><input type="number" id="v-acume" min="0" max="5" placeholder="Acume">
                    <input type="number" id="v-grazia" min="0" max="5" placeholder="Grazia">
                </div>
                <div>
                    <label class="text-blue-300 font-bold uppercase">Extra</label>
                    <input type="text" id="f-p1" placeholder="P1"> <input type="text" id="f-p2" placeholder="P2">
                    <input type="text" id="f-p3" placeholder="P3"> <input type="text" id="f-p4" placeholder="P4">
                    <input type="text" id="f-p5" placeholder="P5"> <input type="text" id="f-p6" placeholder="P6">
                    <div class="flex gap-1 my-1">
                        <input type="number" id="f-hp" min="0" placeholder="HP"><input type="number" id="f-will" min="0" placeholder="WILL">
                    </div>
                    <textarea id="f-bag" placeholder="Zaino..." class="mt-1" rows="3"></textarea>
                    <button onclick="saveTrainer()" class="bg-green-600 w-full py-2 rounded font-black text-white hover:bg-green-500 uppercase mt-2">Salva</button>
                </div>
            </div>
        </div>

        <div id="preview-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6"></div>
        <div id="full-card-container" class="mt-10"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA7Xb8BbyL9s7buH_BW0hx2exD5Tb5G-pk",
            authDomain: "pokerole-app.firebaseapp.com",
            projectId: "pokerole-app",
            storageBucket: "pokerole-app.firebasestorage.app",
            messagingSenderId: "385416519668",
            appId: "1:385416519668:web:908e12b9833f1cdc04a3a1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let base64Img = "";
        let currentTrainersList = [];

        onAuthStateChanged(auth, async (user) => {
            if (!user) { window.location.href = 'index.html'; return; }
            currentUser = user;
            document.body.classList.add('auth-ready');
            loadData();
        });

        window.toggleForm = () => document.getElementById('trainer-form').classList.toggle('hidden');

        window.encodeImg = () => {
            const file = document.getElementById('f-img').files[0];
            const reader = new FileReader();
            reader.onloadend = () => { base64Img = reader.result; };
            if(file) reader.readAsDataURL(file);
        };

        const cleanNum = (id) => Math.max(0, parseInt(document.getElementById(id).value) || 0);

        window.saveTrainer = async () => {
            const nomeInput = document.getElementById('f-name').value.trim();
            if(!nomeInput) return alert("Inserisci un nome!");

            const data = {
                id: nomeInput, // ID uguale al Nome per compatibilit√† scanner
                name: nomeInput,
                img: base64Img || "https://api.dicebear.com/7.x/bottts/svg?seed=" + Date.now(),
                rank: document.getElementById('f-rank').value || "Novizio",
                age: cleanNum('f-age'),
                nature: document.getElementById('f-nature').value || "Audace",
                conf: cleanNum('f-conf'),
                money: cleanNum('f-money'),
                hp: cleanNum('f-hp'),
                will: cleanNum('f-will'),
                bag: document.getElementById('f-bag').value,
                pkmn: [
                    document.getElementById('f-p1').value, document.getElementById('f-p2').value,
                    document.getElementById('f-p3').value, document.getElementById('f-p4').value,
                    document.getElementById('f-p5').value, document.getElementById('f-p6').value
                ],
                attr: { f: cleanNum('f-str'), d: cleanNum('f-dex'), v: cleanNum('f-vit'), i: cleanNum('f-ins') },
                skill: {
                    r: cleanNum('s-rissa'), l: cleanNum('s-lancio'), e: cleanNum('s-evas'), a: cleanNum('s-armi'),
                    al: cleanNum('s-allerta'), at: cleanNum('s-atle'), n: cleanNum('s-nat'), fu: cleanNum('s-furt'),
                    fa: cleanNum('s-fasc'), et: cleanNum('s-etich'), in: cleanNum('s-intim'), pr: cleanNum('s-prest'),
                    cr: cleanNum('s-creaz'), st: cleanNum('s-storia'), me: cleanNum('s-med'), sc: cleanNum('s-scienza')
                },
                virtue: { 
                    g: cleanNum('v-grinta'), c: cleanNum('v-classe'), b: cleanNum('v-bellezza'), 
                    ac: cleanNum('v-acume'), gr: cleanNum('v-grazia') 
                },
                team: [] // Spazio per i pokemon dello scanner
            };
            await updateDoc(doc(db, "Users", currentUser.uid), { allenatori_generati: arrayUnion(data) });
            location.reload();
        };

        async function loadData() {
            const snap = await getDoc(doc(db, "Users", currentUser.uid));
            if (snap.exists() && snap.data().allenatori_generati) {
                currentTrainersList = snap.data().allenatori_generati;
                renderPreviews();
            }
        }

        function renderPreviews() {
            const grid = document.getElementById('preview-grid');
            grid.innerHTML = currentTrainersList.map(t => `
                <div class="preview-card" onclick="showFullCard('${t.id}')">
                    <img src="${t.img}" class="preview-img">
                    <div class="p-3 text-center">
                        <div class="text-[10px] font-black uppercase text-red-500 font-[Orbitron]">${(t.name || "N/A").toUpperCase()}</div>
                    </div>
                </div>
            `).join('');
        }

        window.showFullCard = (id) => {
            const trainer = currentTrainersList.find(t => t.id == id);
            if(!trainer) return;
            const container = document.getElementById('full-card-container');
            container.innerHTML = renderFullUI(trainer);
            window.scrollTo({ top: container.offsetTop - 50, behavior: 'smooth' });
        };

        window.deleteTrainer = async (id) => {
            if (!confirm("‚ö†Ô∏è Eliminare definitivamente questo allenatore?")) return;
            const trainer = currentTrainersList.find(t => t.id == id);
            await updateDoc(doc(db, "Users", currentUser.uid), { allenatori_generati: arrayRemove(trainer) });
            location.reload();
        };

        function renderFullUI(t) {
            const d = (v) => `<div class="flex gap-0.5">${Array.from({length:5}).map((_,i)=>`<div class="dot ${i<v?'filled':''}"></div>`).join('')}</div>`;
            return `
            <div class="trainer-card-ui active">
                <div class="card-header">
                    <div class="font-[Orbitron] font-black text-white text-xl italic uppercase">Pok√©mon League Card</div>
                    <button onclick="this.parentElement.parentElement.classList.remove('active')" class="text-white font-bold hover:text-black">‚úñ CHIUDI</button>
                </div>

                <div class="p-4 grid grid-cols-12 gap-6">
                    <div class="col-span-12 md:col-span-3">
                        <div class="photo-container"><img src="${t.img}"></div>
                        <div class="grid grid-cols-2 gap-2 mt-4">
                            <div class="bg-black/10 p-1 rounded text-center"><span class="label-text">HP</span><div class="data-field text-red-600">${t.hp}</div></div>
                            <div class="bg-black/10 p-1 rounded text-center"><span class="label-text">WILL</span><div class="data-field text-blue-600">${t.will}</div></div>
                        </div>
                    </div>

                    <div class="col-span-12 md:col-span-5 space-y-3">
                        <div class="grid grid-cols-2 gap-2">
                            <div class="col-span-2"><span class="label-text">Name:</span><div class="data-field uppercase text-lg">${(t.name || "N/A")}</div></div>
                            <div><span class="label-text">Age:</span><div class="data-field">${t.age}</div></div>
                            <div><span class="label-text">Money:</span><div class="data-field">$ ${t.money}</div></div>
                            <div><span class="label-text">Nature:</span><div class="data-field uppercase">${t.nature}</div></div>
                            <div><span class="label-text">Rank:</span><div class="data-field uppercase">${t.rank}</div></div>
                        </div>
                        <div class="bg-white/40 p-2 rounded-lg border border-black/10">
                            <span class="label-text text-red-700">Squadra Pok√©mon</span>
                            <div class="grid grid-cols-2 gap-1 mt-1">${t.pkmn.map(p => `<div class="data-field !py-0.5 !text-[9px] truncate">${p || '---'}</div>`).join('')}</div>
                        </div>
                        <div><span class="label-text">Zaino:</span><div class="data-field h-24 overflow-auto italic text-[10px] leading-tight">${t.bag || 'Vuoto'}</div></div>
                        <div class="flex justify-between pt-2">
                            <button onclick="deleteTrainer('${t.id}')" class="text-[9px] font-black text-red-600 uppercase border border-red-600 px-3 py-1 rounded hover:bg-red-600 hover:text-white transition-all">üóë Elimina Profilo</button>
                        </div>
                    </div>

                    <div class="col-span-12 md:col-span-4 bg-black/5 p-3 rounded-lg border border-black/5 space-y-3">
                        <div>
                            <span class="label-text text-blue-800 border-b border-blue-200">Attributi</span>
                            <div class="skill-row">FORZA ${d(t.attr.f)}</div><div class="skill-row">DESTREZZA ${d(t.attr.d)}</div>
                            <div class="skill-row">VITALIT√Ä ${d(t.attr.v)}</div><div class="skill-row">ISTINTO ${d(t.attr.i)}</div>
                        </div>
                        <div class="grid grid-cols-2 gap-x-4">
                            <div>
                                <span class="label-text text-green-800 border-b border-green-200 uppercase">Fisiche</span>
                                <div class="skill-row">RISSA ${d(t.skill.r)}</div><div class="skill-row">LANCIO ${d(t.skill.l)}</div>
                                <div class="skill-row">EVASIONE ${d(t.skill.e)}</div><div class="skill-row">ARMI ${d(t.skill.a)}</div>
                                <div class="skill-row">ALLERTA ${d(t.skill.al)}</div><div class="skill-row">ATLETICA ${d(t.skill.at)}</div>
                                <div class="skill-row">NATURA ${d(t.skill.n)}</div><div class="skill-row">FURTIVIT√Ä ${d(t.skill.fu)}</div>
                            </div>
                            <div>
                                <span class="label-text text-orange-800 border-b border-orange-200 uppercase">Mentali</span>
                                <div class="skill-row">FASCINO ${d(t.skill.fa)}</div><div class="skill-row">ETICHETTA ${d(t.skill.et)}</div>
                                <div class="skill-row">INTIMIDIRE ${d(t.skill.in)}</div><div class="skill-row">PRESTAZIONE ${d(t.skill.pr)}</div>
                                <div class="skill-row">CREAZIONE ${d(t.skill.cr)}</div><div class="skill-row">STORIA ${d(t.skill.st)}</div>
                                <div class="skill-row">MEDICINA ${d(t.skill.me)}</div><div class="skill-row">SCIENZA ${d(t.skill.sc)}</div>
                            </div>
                        </div>
                        <div>
                            <span class="label-text text-purple-800 border-b border-purple-200">Virt√π</span>
                            <div class="skill-row">GRINTA ${d(t.virtue.g)}</div><div class="skill-row">CLASSE ${d(t.virtue.c)}</div>
                            <div class="skill-row">BELLEZZA ${d(t.virtue.b)}</div><div class="skill-row">ACUME ${d(t.virtue.ac)}</div>
                            <div class="skill-row">GRAZIA ${d(t.virtue.gr)}</div>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-400/50 p-3 flex justify-center gap-3 border-t border-gray-500">
                    <div class="flex gap-2">${Array.from({length:8}).map((_,i)=>`<div class="w-8 h-8 rounded-full bg-white border border-gray-600 flex items-center justify-center text-[9px] font-black text-gray-300 shadow-inner">${i+1}</div>`).join('')}</div>
                </div>
            </div>`;
        }
    </script>
</body>
</html>
