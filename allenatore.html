<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trainer Card - Neural ProDex</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --pk-red: #dc2626; --pk-blue: #d6eaf8; --bg-dark: #020617; }
        body { background-color: var(--bg-dark); font-family: 'JetBrains Mono', monospace; color: white; opacity: 0; transition: opacity 0.5s; }
        body.auth-ready { opacity: 1; }

        /* UI SCHEDA STILE POKEMON LEAGUE */
        .trainer-card-ui {
            background-color: #d1d5db; border-radius: 24px; overflow: hidden;
            width: 100%; max-width: 950px; margin: 20px auto;
            border: 6px solid #4b5563; color: #1e293b; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .card-header {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
            padding: 20px 30px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 6px solid #991b1b;
        }
        .header-logo-text { font-family: 'Orbitron'; font-weight: 900; color: white; font-size: 1.5rem; letter-spacing: 1px; italic: true; }
        
        .data-field {
            background-color: var(--pk-blue); border-radius: 6px; padding: 4px 10px;
            border: 2px solid #1e293b; font-weight: 800; color: #1e293b; font-size: 13px;
        }
        .label-text { font-family: 'Orbitron'; font-size: 0.6rem; font-weight: 900; color: #111; text-transform: uppercase; margin-bottom: 2px; display: block; }
        
        .photo-box {
            background: white; border: 4px solid #1e293b; border-radius: 12px;
            width: 100%; aspect-ratio: 3/4; object-fit: cover;
        }

        /* Skills & Dots */
        .dot { width: 7px; height: 7px; border-radius: 50%; border: 1px solid #1e293b; background: white; }
        .dot.filled { background: #1e293b; }
        .skill-row { display: flex; justify-content: space-between; align-items: center; font-size: 10px; font-weight: 700; padding: 1px 0; }

        /* Admin Form */
        .admin-panel { background: #1e293b; border: 2px solid #3b82f6; border-radius: 20px; padding: 25px; margin-bottom: 40px; }
        input, select, textarea { background: #0f172a !important; color: #38bdf8 !important; border: 1px solid #334155 !important; padding: 6px; border-radius: 6px; font-size: 12px; width: 100%; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <h1 class="text-4xl font-black italic tracking-tighter font-[Orbitron] text-white">
                NEURAL <span class="text-red-600">PRODEX</span>
            </h1>
            <div class="flex gap-4">
                <a href="index.html" class="bg-white/10 hover:bg-white/20 px-6 py-2 rounded-xl text-xs font-black uppercase transition-all flex items-center gap-2 border border-white/20">
                    üè† Home
                </a>
                <button onclick="toggleForm()" class="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded-xl text-xs font-black uppercase shadow-lg shadow-blue-600/20">
                    ‚ûï Nuovo Allenatore
                </button>
            </div>
        </div>

        <div id="trainer-form" class="hidden admin-panel">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="space-y-3">
                    <label class="text-[10px] font-bold text-blue-400">IDENTIT√Ä</label>
                    <input type="file" id="f-img" onchange="encodeImg()">
                    <input type="text" id="f-name" placeholder="Nome Allenatore">
                    <input type="text" id="f-rank" placeholder="Rango (es. Starter)">
                    <input type="number" id="f-age" placeholder="Et√†">
                    <input type="text" id="f-nature" placeholder="Natura">
                    <input type="number" id="f-conf" placeholder="Confidence (1-5)">
                    <input type="number" id="f-money" placeholder="Soldi ($)">
                </div>
                <div class="space-y-3">
                    <label class="text-[10px] font-bold text-blue-400">ATTRIBUTI & RISORSE</label>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="f-hp" placeholder="HP Max">
                        <input type="number" id="f-will" placeholder="Will Max">
                        <input type="number" id="f-str" placeholder="Forza">
                        <input type="number" id="f-dex" placeholder="Destrezza">
                        <input type="number" id="f-vit" placeholder="Vitalit√†">
                        <input type="number" id="f-ins" placeholder="Istinto">
                    </div>
                    <label class="text-[10px] font-bold text-blue-400">SQUADRA (Nomi)</label>
                    <input type="text" id="f-p1" placeholder="Pok√©mon 1"><input type="text" id="f-p2" placeholder="Pok√©mon 2">
                </div>
                <div class="space-y-3">
                    <label class="text-[10px] font-bold text-blue-400">ABILI√Ä (SKILLS)</label>
                    <div class="grid grid-cols-2 gap-x-2 gap-y-1">
                        <input type="number" id="s-rissa" placeholder="Rissa"> <input type="number" id="s-lancio" placeholder="Lancio">
                        <input type="number" id="s-evas" placeholder="Evasione"> <input type="number" id="s-armi" placeholder="Armi">
                        <input type="number" id="s-all" placeholder="Allerta"> <input type="number" id="s-atle" placeholder="Atletica">
                        <input type="number" id="s-nat" placeholder="Natura"> <input type="number" id="s-furt" placeholder="Furtivit√†">
                    </div>
                </div>
                <div class="space-y-3">
                    <label class="text-[10px] font-bold text-blue-400">SOCIAL & ZAINO</label>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="v-grinta" placeholder="Grinta"> <input type="number" id="v-classe" placeholder="Classe">
                    </div>
                    <textarea id="f-bag" placeholder="Contenuto Zaino..." rows="4"></textarea>
                    <button onclick="saveTrainer()" class="bg-green-600 w-full py-3 rounded-lg font-black text-white hover:bg-green-500 transition-all uppercase text-xs">Salva Operatore</button>
                </div>
            </div>
        </div>

        <div id="cards-list" class="space-y-12"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA7Xb8BbyL9s7buH_BW0hx2exD5Tb5G-pk",
            authDomain: "pokerole-app.firebaseapp.com",
            projectId: "pokerole-app",
            storageBucket: "pokerole-app.firebasestorage.app",
            messagingSenderId: "385416519668",
            appId: "1:385416519668:web:908e12b9833f1cdc04a3a1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let base64Img = "";

        onAuthStateChanged(auth, async (user) => {
            if (!user) { window.location.href = 'index.html'; return; }
            currentUser = user;
            document.body.classList.add('auth-ready');
            loadTrainers();
        });

        window.toggleForm = () => document.getElementById('trainer-form').classList.toggle('hidden');

        window.encodeImg = () => {
            const file = document.getElementById('f-img').files[0];
            const reader = new FileReader();
            reader.onloadend = () => { base64Img = reader.result; };
            reader.readAsDataURL(file);
        };

        window.saveTrainer = async () => {
            const data = {
                id: Date.now(),
                img: base64Img || "https://api.dicebear.com/7.x/pixel-art/svg",
                name: document.getElementById('f-name').value,
                rank: document.getElementById('f-rank').value,
                age: document.getElementById('f-age').value,
                nature: document.getElementById('f-nature').value,
                conf: document.getElementById('f-conf').value,
                money: document.getElementById('f-money').value,
                hp: document.getElementById('f-hp').value,
                will: document.getElementById('f-will').value,
                bag: document.getElementById('f-bag').value,
                pkmn: [document.getElementById('f-p1').value, document.getElementById('f-p2').value, "", "", "", ""],
                stats: { 
                    forza: document.getElementById('f-str').value, dex: document.getElementById('f-dex').value, 
                    vit: document.getElementById('f-vit').value, ins: document.getElementById('f-ins').value 
                },
                skills: {
                    rissa: document.getElementById('s-rissa').value, lancio: document.getElementById('s-lancio').value,
                    evas: document.getElementById('s-evas').value, armi: document.getElementById('s-armi').value,
                    all: document.getElementById('s-all').value, atle: document.getElementById('s-atle').value,
                    nat: document.getElementById('s-nat').value, furt: document.getElementById('s-furt').value
                },
                social: {
                    grinta: document.getElementById('v-grinta').value, classe: document.getElementById('v-classe').value
                }
            };
            await updateDoc(doc(db, "Users", currentUser.uid), { allenatori_generati: arrayUnion(data) });
            location.reload();
        };

        async function loadTrainers() {
            const snap = await getDoc(doc(db, "Users", currentUser.uid));
            if (snap.exists() && snap.data().allenatori_generati) {
                document.getElementById('cards-list').innerHTML = snap.data().allenatori_generati.map(t => renderUI(t)).join('');
            }
        }

        function renderUI(t) {
            const dots = (v) => `<div class="flex gap-0.5">${Array.from({length:5}).map((_,i)=>`<div class="dot ${i<v?'filled':''}"></div>`).join('')}</div>`;
            
            return `
            <div class="trainer-card-ui">
                <div class="card-header">
                    <div class="header-logo-text uppercase italic">Pok√©mon League</div>
                    <div class="text-right">
                        <span class="label-text !text-white/80">Trainer's Card Rank:</span>
                        <div class="data-field min-w-[140px]">${t.rank}</div>
                    </div>
                </div>

                <div class="p-6 grid grid-cols-12 gap-6">
                    <div class="col-span-12 md:col-span-3 space-y-4">
                        <img src="${t.img}" class="photo-box shadow-lg">
                        <div class="space-y-2">
                            <div class="flex items-center justify-between bg-black/10 p-1 rounded-lg">
                                <span class="label-text !mb-0">HP</span><div class="data-field w-20 text-center">${t.hp}</div>
                            </div>
                            <div class="flex items-center justify-between bg-black/10 p-1 rounded-lg">
                                <span class="label-text !mb-0">WILL</span><div class="data-field w-20 text-center">${t.will}</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-span-12 md:col-span-6 space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div class="col-span-2"><span class="label-text">Name:</span><div class="data-field uppercase text-lg">${t.name}</div></div>
                            <div><span class="label-text">Age:</span><div class="data-field">${t.age}</div></div>
                            <div><span class="label-text">Money:</span><div class="data-field">$ ${t.money}</div></div>
                            <div class="col-span-1"><span class="label-text">Nature:</span><div class="data-field uppercase">${t.nature}</div></div>
                            <div><span class="label-text">Confidence:</span><div class="data-field">${t.conf} / 5</div></div>
                        </div>

                        <div class="bg-white/40 p-3 rounded-xl border border-gray-400">
                            <span class="label-text text-red-700">Squadra Pok√©mon (6 Slot)</span>
                            <div class="grid grid-cols-2 gap-2 mt-1">
                                ${t.pkmn.map(p => `<div class="data-field !py-1 !text-[10px] h-7 truncate">${p || '---'}</div>`).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <span class="label-text">Zaino & Strumenti:</span>
                            <div class="data-field h-24 overflow-auto text-[11px] font-medium italic">"${t.bag || 'Zaino vuoto...'}"</div>
                        </div>
                    </div>

                    <div class="col-span-12 md:col-span-3 space-y-4 bg-black/5 p-3 rounded-xl border border-black/5">
                        <div>
                            <span class="label-text text-blue-800 border-b border-blue-200">Attributi</span>
                            <div class="skill-row">FORZA ${dots(t.stats.forza)}</div>
                            <div class="skill-row">DESTREZZA ${dots(t.stats.dex)}</div>
                            <div class="skill-row">VITALIT√Ä ${dots(t.stats.vit)}</div>
                            <div class="skill-row">ISTINTO ${dots(t.stats.ins)}</div>
                        </div>
                        <div>
                            <span class="label-text text-green-800 border-b border-green-200">Skill Principali</span>
                            <div class="skill-row">RISSA ${dots(t.skills.rissa)}</div>
                            <div class="skill-row">LANCIO ${dots(t.skills.lancio)}</div>
                            <div class="skill-row">EVASIONE ${dots(t.skills.evas)}</div>
                            <div class="skill-row">ALLERTA ${dots(t.skills.all)}</div>
                        </div>
                        <div>
                            <span class="label-text text-purple-800 border-b border-purple-200">Virt√π Sociali</span>
                            <div class="skill-row">GRINTA ${dots(t.social.grinta)}</div>
                            <div class="skill-row">CLASSE ${dots(t.social.classe)}</div>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-400/50 p-3 flex justify-center gap-3 border-t-2 border-gray-500">
                    ${Array.from({length:8}).map((_,i)=>`<div class="w-9 h-9 rounded-full bg-white border-2 border-gray-600 flex items-center justify-center text-[10px] font-black text-gray-400">${i+1}</div>`).join('')}
                    <span class="label-text self-center ml-4">Medaglie della Lega</span>
                </div>
            </div>`;
        }
    </script>
</body>
</html>
