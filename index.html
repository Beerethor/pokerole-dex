<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeRole ProDex - Central Hub</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@500;800&display=swap" rel="stylesheet">

    <style>
        :root { --accent: #ca8a04; --bg-dark: #020617; }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-dark); 
            color: #f8fafc; 
            overflow-x: hidden; 
        }
        .glass-card { 
            background: rgba(15, 23, 42, 0.6); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(51, 65, 85, 0.3); 
        }
        .btn-main { 
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        .btn-main:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 10px 20px rgba(0,0,0,0.4); 
        }
        .font-mono-data { font-family: 'JetBrains Mono', monospace; }
        
        /* Animazione per l'avatar loggato */
        .pulse-glow { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(234, 179, 8, 0); }
            100% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-6">

    <div class="fixed top-0 left-0 w-full h-full -z-10 opacity-20 pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-yellow-600 rounded-full blur-[120px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-blue-900 rounded-full blur-[120px]"></div>
    </div>

    <header class="text-center mb-12">
        <h1 class="text-6xl font-black italic tracking-tighter uppercase font-mono-data">
            <span class="text-yellow-500">POKEROLE</span> HUB
        </h1>
        <p class="text-[10px] text-slate-500 font-black tracking-[0.5em] uppercase mt-2">Accesso Autorizzato Requisito</p>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 w-full max-w-5xl">
        
        <div class="glass-card p-8 rounded-[2.5rem] flex flex-col justify-center min-h-[400px]">
            <h2 class="text-xl font-black uppercase mb-6 italic border-b border-slate-800 pb-2 text-yellow-500">Terminal</h2>
            
            <div id="auth-ui">
                <button onclick="loginGoogle()" class="w-full bg-white text-black font-black py-4 rounded-2xl flex items-center justify-center gap-3 mb-6 btn-main text-xs uppercase">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5">
                    Accedi con Google
                </button>

                <div class="relative flex items-center mb-6">
                    <div class="flex-grow border-t border-slate-800"></div>
                    <span class="px-4 text-[10px] text-slate-500 font-bold uppercase">Oppure Email</span>
                    <div class="flex-grow border-t border-slate-800"></div>
                </div>

                <div class="space-y-4">
                    <input type="email" id="email" placeholder="Email" class="w-full bg-slate-950 border border-slate-800 rounded-xl p-4 text-sm outline-none focus:border-yellow-500 transition-all font-bold text-white">
                    <input type="password" id="password" placeholder="Password" class="w-full bg-slate-950 border border-slate-800 rounded-xl p-4 text-sm outline-none focus:border-yellow-500 transition-all font-bold text-white">
                    <div class="flex gap-2">
                        <button onclick="loginEmail()" class="flex-1 bg-slate-800 hover:bg-slate-700 py-3 rounded-xl font-black text-[10px] uppercase">Login</button>
                        <button onclick="registerEmail()" class="flex-1 border border-slate-800 hover:bg-slate-800 py-3 rounded-xl font-black text-[10px] uppercase">Registrati</button>
                    </div>
                </div>
            </div>

            <div id="user-ui" class="hidden text-center">
                <div class="flex flex-col items-center">
                    <a href="profile.html" class="group flex flex-col items-center transition-transform hover:scale-105" title="Modifica Profilo">
                        <div class="relative">
                            <img id="user-img" src="" class="w-28 h-28 rounded-full border-4 border-yellow-500 mb-4 shadow-2xl transition-all group-hover:border-blue-500 object-cover bg-slate-900">
                            <div class="absolute bottom-6 right-0 bg-blue-600 rounded-full p-2 border-2 border-slate-950 opacity-0 group-hover:opacity-100 transition-opacity">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                                </svg>
                            </div>
                        </div>
                        <h3 id="user-name" class="text-3xl font-black uppercase italic group-hover:text-yellow-500 transition-colors">Utente</h3>
                    </a>
                    <p id="user-email" class="text-slate-500 text-xs font-mono-data mb-6 mt-1 tracking-wider"></p>
                    <button onclick="logout()" class="text-red-500 font-black uppercase text-[9px] tracking-[0.4em] hover:text-red-400 transition-colors">Disconnetti Terminale</button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 gap-4">
            <a href="database.html" class="glass-card p-10 rounded-[2.5rem] btn-main group relative overflow-hidden">
                <div class="relative z-10">
                    <h3 class="text-3xl font-black italic uppercase tracking-tighter group-hover:text-yellow-500 transition-colors">ðŸ“œ Database</h3>
                    <p class="text-slate-500 text-[10px] font-bold uppercase mt-1">Archivio Completo Pokemon & Tecniche</p>
                </div>
                <div class="absolute right-[-20px] bottom-[-20px] text-8xl opacity-5 group-hover:opacity-10 transition-all">ðŸ“œ</div>
            </a>

            <a href="generator.html" class="glass-card p-10 rounded-[2.5rem] btn-main group relative overflow-hidden">
                <div class="relative z-10">
                    <h3 class="text-3xl font-black italic uppercase tracking-tighter group-hover:text-blue-500 transition-colors">ðŸŽ² Generatore</h3>
                    <p class="text-slate-500 text-[10px] font-bold uppercase mt-1">Protocollo Scansione UnitÃ  Casuali</p>
                </div>
                <div class="absolute right-[-20px] bottom-[-20px] text-8xl opacity-5 group-hover:opacity-10 transition-all">ðŸŽ²</div>
            </a>
            
            <div class="bg-yellow-600/10 border border-yellow-600/20 p-6 rounded-[2.5rem]">
                <p class="text-[10px] text-yellow-500 font-black uppercase italic leading-relaxed">
                    Stato Uplink: <span class="text-green-500">Sincronizzato</span>. I cambiamenti al profilo eseguiti sul server verranno applicati istantaneamente a questo terminale.
                </p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, 
            signInWithEmailAndPassword, createUserWithEmailAndPassword 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIGURAZIONE FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyA7Xb8BbyL9s7buH_BW0hx2exD5Tb5G-pk",
            authDomain: "pokerole-app.firebaseapp.com",
            projectId: "pokerole-app",
            storageBucket: "pokerole-app.firebasestorage.app",
            messagingSenderId: "385416519668",
            appId: "1:385416519668:web:908e12b9833f1cdc04a3a1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // FUNZIONI DI AUTH ESPORTE GLOBALMENTE
        window.loginGoogle = () => signInWithPopup(auth, provider).catch(err => alert(err.message));
        
        window.loginEmail = () => {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            signInWithEmailAndPassword(auth, e, p).catch(err => alert("Errore Accesso: Credenziali non valide."));
        };

        window.registerEmail = () => {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            createUserWithEmailAndPassword(auth, e, p).then(() => alert("Profilo creato correttamente!")).catch(err => alert(err.message));
        };

        window.logout = () => {
            localStorage.removeItem('user_id'); 
            signOut(auth);
        };

        // --- CORE: MONITORAGGIO SINCRONIZZATO ---
        onAuthStateChanged(auth, async (user) => {
            const authUI = document.getElementById('auth-ui');
            const userUI = document.getElementById('user-ui');

            if (user) {
                // Valori di default
                let finalName = user.displayName || user.email.split('@')[0];
                let finalImg = `https://api.dicebear.com/7.x/bottts/svg?seed=${finalName}`;
                
                // Tenta scaricamento dati personalizzati dal server (Firestore)
                try {
                    const userRef = doc(db, "Users", user.uid);
                    const userSnap = await getDoc(userRef);
                    if (userSnap.exists()) {
                        const cloudData = userSnap.data();
                        finalName = cloudData.displayName || finalName;
                        finalImg = cloudData.profilePic || finalImg; // Usa l'immagine Base64 se presente
                    }
                } catch (e) { console.warn("Sincronizzazione Cloud non disponibile."); }

                // Aggiorna cache locale per Generator.html
                localStorage.setItem('user_id', finalName);

                // Aggiorna Interfaccia Hub
                authUI.classList.add('hidden');
                userUI.classList.remove('hidden');
                
                document.getElementById('user-name').innerText = finalName;
                document.getElementById('user-email').innerText = user.email;
                document.getElementById('user-img').src = finalImg;
            } else {
                authUI.classList.remove('hidden');
                userUI.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
