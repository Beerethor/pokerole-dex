<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeRole ProDex 2026 - Master Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        
        /* Effetti per i pulsanti di navigazione */
        .tab-btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .tab-active { background-color: #ca8a04; color: #0f172a; font-weight: 900; transform: scale(1.05); shadow: 0 10px 20px rgba(0,0,0,0.4); }
        .tab-inactive { color: #94a3b8; background-color: #1e293b; }
        .tab-inactive:hover { background-color: #334155; color: white; }
        
        /* Scrollbar personalizzata per un look pi√π moderno */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #ca8a04; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen pb-20">

    <div class="max-w-6xl mx-auto p-4">
        <header class="py-10 flex flex-col items-center text-center">
            <h1 class="text-5xl font-black text-yellow-500 tracking-tighter uppercase italic">PokeRole <span class="text-white">ProDex</span></h1>
            <p class="text-slate-500 text-[10px] mt-2 uppercase tracking-[0.3em] font-bold italic">Multi-Keyword Search & Rank System 2.0</p>
            
            <div class="grid grid-cols-3 md:grid-cols-5 gap-2 bg-slate-900/50 p-2 rounded-3xl mt-8 w-full border border-slate-800 shadow-2xl">
                <button onclick="switchTab('pkmn')" id="tabPkmn" class="tab-btn tab-active py-3 rounded-2xl text-[10px] uppercase">Pok√©mon</button>
                <button onclick="switchTab('tech')" id="tabTech" class="tab-btn tab-inactive py-3 rounded-2xl text-[10px] uppercase">Tecniche</button>
                <button onclick="switchTab('abil')" id="tabAbil" class="tab-btn tab-inactive py-3 rounded-2xl text-[10px] uppercase">Abilit√†</button>
                <button onclick="switchTab('max')" id="tabMax" class="tab-btn tab-inactive py-3 rounded-2xl text-[10px] uppercase">Max Moves</button>
                <button onclick="switchTab('zmove')" id="tabZmove" class="tab-btn tab-inactive py-3 rounded-2xl text-[10px] uppercase">Z-Moves</button>
            </div>
        </header>

        <div class="bg-slate-900 p-6 rounded-[2.5rem] shadow-2xl border border-slate-800 mb-10 sticky top-4 z-50 backdrop-blur-md bg-opacity-95">
            <input type="text" id="mainSearch" oninput="runSearch()" placeholder="Cerca (es: 'Acqua Beginner' o 'Fuoco Starter')..." 
                class="w-full bg-slate-950 border-none rounded-2xl p-4 mb-4 text-white focus:ring-2 focus:ring-yellow-500 shadow-inner text-sm">
            
            <div class="flex flex-col md:flex-row gap-2">
                <select id="visualRank" onchange="runSearch()" class="bg-slate-800 rounded-xl p-4 text-sm border-none text-yellow-500 font-black w-full md:w-2/3 cursor-pointer">
                    <option value="Starter">Visualizza come: STARTER</option>
                    <option value="Beginner">Visualizza come: BEGINNER</option>
                    <option value="Amateur">Visualizza come: AMATEUR</option>
                    <option value="Ace">Visualizza come: ACE</option>
                    <option value="Pro">Visualizza come: PRO</option>
                    <option value="Master">Visualizza come: MASTER</option>
                </select>
                <button onclick="randomGen()" class="bg-yellow-600 hover:bg-yellow-500 text-slate-950 px-6 py-4 rounded-xl text-xs transition-all font-black uppercase w-full md:w-1/3">üé≤ Casuale</button>
            </div>
            <div id="counter" class="text-[9px] text-slate-500 mt-3 ml-2 uppercase font-bold tracking-widest"></div>
        </div>

        <div id="results" class="grid grid-cols-1 md:grid-cols-2 gap-8"></div>
    </div>

    <script>
        // Database locale
        let db = { pkmn: [], tech: [], abil: [], max: [], zmove: [] };
        let currentTab = 'pkmn';
        
        // Gerarchia ranghi per logica sblocco mosse
        const RANGHI = ["Starter", "Beginner", "Amateur", "Ace", "Pro", "Master"];

        // 1. CARICAMENTO DATI JSON
        async function loadData() {
            try {
                const results = await Promise.all([
                    fetch('pokemon.json').then(r => r.json()),
                    fetch('tecniche.json').then(r => r.json()),
                    fetch('abilita.json').then(r => r.json()),
                    fetch('max_moves.json').then(r => r.json()),
                    fetch('mosse_z.json').then(r => r.json())
                ]);
                db.pkmn = results[0]; db.tech = results[1]; db.abil = results[2]; db.max = results[3]; db.zmove = results[4];
                runSearch();
            } catch (e) {
                document.getElementById('results').innerHTML = `<div class="col-span-full text-center p-10 bg-red-900/20 rounded-3xl border border-red-500 text-red-400 font-bold uppercase text-xs">Errore: Verifica il formato dei file JSON (controlla le virgole!)</div>`;
            }
        }

        // 2. CAMBIO TAB
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.replace('tab-active', 'tab-inactive'));
            const activeId = 'tab' + tab.charAt(0).toUpperCase() + tab.slice(1);
            document.getElementById(activeId).classList.replace('tab-inactive', 'tab-active');
            
            // Il selettore rango appare solo se siamo sui Pok√©mon
            document.getElementById('visualRank').style.display = tab === 'pkmn' ? 'block' : 'none';
            runSearch();
        }

        // 3. MOTORE DI RICERCA MULTI-PAROLA E FILTRO RANGO
        function runSearch() {
            // Dividiamo l'input in pi√π parole chiave
            const keywords = document.getElementById('mainSearch').value.toLowerCase().trim().split(/\s+/);
            const selectedRank = document.getElementById('visualRank').value;
            let filtered = [];

            if (currentTab === 'pkmn') {
                filtered = db.pkmn.filter(p => {
                    // Ogni parola chiave deve trovare un match (Logica AND)
                    return keywords.every(kw => {
                        return p.nome.toLowerCase().includes(kw) || 
                               (p.tipo || []).some(t => t.toLowerCase().includes(kw)) ||
                               (p.rango_suggerito || "").toLowerCase().includes(kw) ||
                               (p.abilita || []).some(a => a.toLowerCase().includes(kw));
                    });
                }).map(p => ({ ...p, rango_attuale: selectedRank }));
                renderPokemon(filtered);
            } 
            else if (currentTab === 'tech') {
                filtered = db.tech.filter(t => keywords.every(kw => t.nome.toLowerCase().includes(kw) || t.descrizione.toLowerCase().includes(kw)));
                renderTech(filtered);
            }
            else if (currentTab === 'abil') {
                filtered = db.abil.filter(a => keywords.every(kw => a.nome.toLowerCase().includes(kw) || a.effetto.toLowerCase().includes(kw)));
                renderAbil(filtered);
            }
            // ... (altre tab seguono la stessa logica keywords.every)
            
            // Aggiorna contatore
            document.getElementById('counter').innerText = `Trovati: ${filtered.length} risultati`;
        }

        // 4. RENDERING SCHEDA POKEMON (BASE/MAX + ABILIT√Ä)
        function renderPokemon(list) {
            const container = document.getElementById('results');
            container.innerHTML = list.map(p => {
                const currentRankIdx = RANGHI.indexOf(p.rango_attuale);
                
                return `
                <div class="bg-slate-900 rounded-[3rem] overflow-hidden border border-slate-800 shadow-2xl flex flex-col group hover:border-yellow-600/30 transition-all">
                    <div class="bg-slate-800/50 p-6 flex justify-between items-center border-b border-slate-800">
                        <div>
                            <span class="text-yellow-600 font-mono text-[10px] font-black tracking-widest uppercase">#${p.pokedex_id} Rango: ${p.rango_suggerito}</span>
                            <h2 class="text-3xl font-black text-white uppercase tracking-tighter">${p.nome}</h2>
                            <div class="flex gap-2 mt-2">
                                ${(p.tipo || []).map(t => `<span class="bg-slate-950 text-[8px] font-black px-2 py-1 rounded border border-slate-800 uppercase text-slate-400">${t}</span>`).join('')}
                            </div>
                        </div>
                        <div class="bg-slate-950 p-3 rounded-2xl border border-red-900/30 text-center min-w-[75px]">
                            <span class="block text-[8px] text-red-600 font-black uppercase mb-1">Vitalit√†</span>
                            <span class="text-2xl font-black text-white leading-none">${p.vitalita_max?.hp || 0}</span>
                        </div>
                    </div>

                    <div class="p-8">
                        <div class="flex flex-col sm:flex-row gap-6 mb-8 items-center sm:items-start">
                            <img src="${p.immagine}" class="w-24 h-24 object-contain drop-shadow-2xl group-hover:scale-110 transition-transform">
                            <div class="flex-1">
                                <div class="bg-slate-800/30 p-4 rounded-2xl italic text-[11px] text-slate-400 border-l-4 border-yellow-600 mb-3">
                                    "${p.descrizione}"
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    ${(p.abilita || []).map(a => `<span class="bg-blue-900/20 text-blue-400 text-[9px] font-black px-3 py-1 rounded-full border border-blue-500/20 uppercase">Abilit√†: ${a}</span>`).join('')}
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-5 gap-2 mb-8">
                            ${Object.entries(p.attributi || {}).map(([attr, val]) => `
                                <div class="bg-slate-950 p-2 rounded-xl text-center border border-slate-800">
                                    <span class="text-[8px] text-slate-500 uppercase block font-black mb-1">${attr.substring(0,3)}</span>
                                    <div class="flex flex-col items-center">
                                        <span class="text-sm font-black text-yellow-500">${val.base}</span>
                                        <div class="w-8 h-[1px] bg-slate-800 my-1"></div>
                                        <span class="text-[9px] font-bold text-slate-600 uppercase">M:${val.max}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>

                        <div class="bg-slate-950/50 p-4 rounded-2xl border border-slate-800/50 mb-8 text-[10px] font-black uppercase flex flex-col gap-1">
                            <div class="text-slate-500">Linea: <span class="text-yellow-600 ml-1 font-bold">${p.linea_evolutiva.join(' > ')}</span></div>
                            <div class="flex justify-between">
                                <span class="text-slate-500">Stadio: <span class="text-white ml-1">${p.stadio_evolutivo}</span></span>
                                <span class="text-slate-500">Tempo: <span class="text-white ml-1">${p.tempo_evoluzione}</span></span>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <div class="flex justify-between items-end border-b border-slate-800 pb-2">
                                <span class="text-[10px] text-slate-600 font-black uppercase">Piano di Apprendimento</span>
                                <span class="text-[9px] text-yellow-600 font-black uppercase italic">Visto come ${p.rango_attuale}</span>
                            </div>
                            ${(p.tecniche || []).map(m => {
                                const mRankIdx = RANGHI.indexOf(m.rango);
                                const isLocked = mRankIdx > currentRankIdx;
                                return `
                                <div class="flex justify-between items-center p-3 rounded-xl border-l-2 transition-all ${isLocked ? 'bg-slate-950/30 opacity-20 grayscale border-slate-800' : 'bg-slate-800 border-yellow-600 shadow-lg'}">
                                    <span class="text-xs ${isLocked ? 'text-slate-500' : 'text-slate-100'} font-bold">${m.nome}</span>
                                    <span class="text-[9px] ${isLocked ? 'text-slate-700' : 'text-yellow-600'} uppercase font-black">${m.rango}</span>
                                </div>`;
                            }).join('')}
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        // --- ALTRE FUNZIONI DI RENDERING ---
        function renderTech(list) {
            document.getElementById('results').innerHTML = list.map(t => `<div class="bg-slate-900 p-6 rounded-3xl border border-slate-800">
                <h3 class="text-xl font-black text-white uppercase">${t.nome}</h3>
                <p class="text-xs text-slate-400 mt-2">${t.descrizione}</p>
                <div class="mt-4 grid grid-cols-2 gap-2 text-[10px] font-bold uppercase">
                    <div class="bg-slate-950 p-2 rounded-lg">ACC: ${t.accuratezza}</div>
                    <div class="bg-slate-950 p-2 rounded-lg">DANNO: ${t.pool_danno}</div>
                </div>
            </div>`).join('');
        }

        function renderAbil(list) {
            document.getElementById('results').innerHTML = list.map(a => `<div class="bg-slate-900 p-8 rounded-[2.5rem] border-l-8 border-blue-600">
                <h3 class="text-2xl font-black text-blue-500 uppercase tracking-tighter">${a.nome}</h3>
                <p class="text-sm text-slate-300 mt-4 leading-relaxed">${a.effetto}</p>
            </div>`).join('');
        }

        // Altri render (Max e Z) seguono lo stesso stile pulito...
        function renderMax(list) {
            document.getElementById('results').innerHTML = list.map(m => `<div class="bg-slate-900 p-6 rounded-3xl border border-pink-900/30"><h3 class="text-xl font-black text-pink-500 uppercase">${m.nome}</h3><p class="text-xs text-slate-200 mt-3">${m.effetti_aggiuntivi}</p></div>`).join('');
        }

        function renderZ(list) {
            document.getElementById('results').innerHTML = list.map(z => `<div class="bg-slate-900 p-6 rounded-3xl border border-yellow-700/30 text-center"><h3 class="text-xl font-black text-yellow-500 uppercase">${z.nome}</h3><p class="text-[10px] text-slate-500 mt-2 tracking-widest uppercase">Mossa Z</p></div>`).join('');
        }

        // 5. GENERATORE CASUALE
        function randomGen() {
            const currentDb = db[currentTab];
            if(!currentDb.length) return;
            const res = [currentDb[Math.floor(Math.random()*currentDb.length)]];
            if(currentTab === 'pkmn') { res[0].rango_attuale = document.getElementById('visualRank').value; renderPokemon(res); }
            else if(currentTab === 'tech') renderTech(res);
            else if(currentTab === 'abil') renderAbil(res);
            else if(currentTab === 'max') renderMax(res);
            else renderZ(res);
        }

        // Avvio automatico
        loadData();
    </script>
</body>
</html>
