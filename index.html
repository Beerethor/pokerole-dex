<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeRole ProDex 2026 - Master Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        
        /* Stili per le Tab attive e inattive */
        .tab-btn { transition: all 0.3s ease; }
        .tab-active { background-color: #ca8a04; color: #0f172a; font-weight: 900; transform: scale(1.05); shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5); }
        .tab-inactive { color: #94a3b8; background-color: #1e293b; }
        .tab-inactive:hover { background-color: #334155; color: white; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen pb-20">

    <div class="max-w-6xl mx-auto p-4">
        <header class="py-10 flex flex-col items-center text-center">
            <h1 class="text-5xl font-black text-yellow-500 tracking-tighter uppercase italic">PokeRole <span class="text-white">ProDex</span></h1>
            <p class="text-slate-500 text-xs mt-2 uppercase tracking-[0.2em] font-bold">Database Avanzato per Allenatori e Master</p>
            
            <div class="grid grid-cols-3 md:grid-cols-5 gap-2 bg-slate-900/50 p-2 rounded-3xl mt-8 w-full border border-slate-800 shadow-2xl">
                <button onclick="switchTab('pkmn')" id="tabPkmn" class="tab-btn tab-active py-3 rounded-2xl text-[10px] uppercase">Pok√©mon</button>
                <button onclick="switchTab('tech')" id="tabTech" class="tab-btn tab-inactive py-3 rounded-2xl text-[10px] uppercase">Tecniche</button>
                <button onclick="switchTab('abil')" id="tabAbil" class="tab-btn tab-inactive py-3 rounded-2xl text-[10px] uppercase">Abilit√†</button>
                <button onclick="switchTab('max')" id="tabMax" class="tab-btn tab-inactive py-3 rounded-2xl text-[10px] uppercase border-pink-900/30">Max Moves</button>
                <button onclick="switchTab('zmove')" id="tabZmove" class="tab-btn tab-inactive py-3 rounded-2xl text-[10px] uppercase border-yellow-900/30">Z-Moves</button>
            </div>
        </header>

        <div class="bg-slate-900 p-6 rounded-[2.5rem] shadow-2xl border border-slate-800 mb-10 sticky top-4 z-50 backdrop-blur-md bg-opacity-90">
            <input type="text" id="mainSearch" oninput="runSearch()" placeholder="Cerca Pok√©mon, Tipo o Rango (es: Amateur)..." 
                class="w-full bg-slate-950 border-none rounded-2xl p-4 mb-4 text-white focus:ring-2 focus:ring-yellow-500 shadow-inner text-sm">
            
            <div class="flex flex-col md:flex-row gap-2">
                <select id="visualRank" onchange="runSearch()" class="bg-slate-800 rounded-xl p-4 text-sm border-none text-yellow-500 font-black w-full md:w-2/3">
                    <option value="Starter">Mostra Pok√©mon come: STARTER</option>
                    <option value="Beginner">Mostra Pok√©mon come: BEGINNER</option>
                    <option value="Amateur">Mostra Pok√©mon come: AMATEUR</option>
                    <option value="Ace">Mostra Pok√©mon come: ACE</option>
                    <option value="Pro">Mostra Pok√©mon come: PRO</option>
                    <option value="Master">Mostra Pok√©mon come: MASTER</option>
                </select>
                <button onclick="randomGen()" class="bg-yellow-600 hover:bg-yellow-500 text-slate-950 px-6 py-4 rounded-xl text-xs transition-all font-black uppercase w-full md:w-1/3">üé≤ Casuale</button>
            </div>
        </div>

        <div id="results" class="grid grid-cols-1 md:grid-cols-2 gap-8"></div>
    </div>

    <script>
        // MEMORIA DATI: conterr√† i dati estratti dai file JSON
        let db = { pkmn: [], tech: [], abil: [], max: [], zmove: [] };
        let currentTab = 'pkmn';
        
        // GERARCHIA RANGHI: utilizzata per la logica di oscuramento delle mosse
        const RANGHI = ["Starter", "Beginner", "Amateur", "Ace", "Pro", "Master"];

        // 1. CARICAMENTO DATI: legge i file JSON caricati su GitHub/Netlify
        async function loadData() {
            try {
                const fetchList = [
                    fetch('pokemon.json').then(r => r.json()),
                    fetch('tecniche.json').then(r => r.json()),
                    fetch('abilita.json').then(r => r.json()),
                    fetch('max_moves.json').then(r => r.json()),
                    fetch('mosse_z.json').then(r => r.json())
                ];
                const results = await Promise.all(fetchList);
                db.pkmn = results[0];
                db.tech = results[1];
                db.abil = results[2];
                db.max = results[3];
                db.zmove = results[4];
                runSearch(); // Mostra i risultati iniziali
            } catch (e) {
                console.error("Errore Caricamento JSON:", e);
                document.getElementById('results').innerHTML = `
                <div class="col-span-full text-center p-10 bg-red-900/20 rounded-3xl border border-red-500 text-red-400 font-bold">
                    ERRORE: Uno o pi√π file JSON contengono errori di sintassi (controlla le virgole!).
                </div>`;
            }
        }

        // 2. CAMBIO CATEGORIA (TAB)
        function switchTab(tab) {
            currentTab = tab;
            const btnMap = { pkmn: 'tabPkmn', tech: 'tabTech', abil: 'tabAbil', max: 'tabMax', zmove: 'tabZmove' };
            Object.values(btnMap).forEach(id => {
                document.getElementById(id).classList.remove('tab-active');
                document.getElementById(id).classList.add('tab-inactive');
            });
            document.getElementById(btnMap[tab]).classList.add('tab-active');
            document.getElementById(btnMap[tab]).classList.remove('tab-inactive');
            
            // Il selettore di rango serve solo per i Pok√©mon
            document.getElementById('visualRank').style.display = tab === 'pkmn' ? 'block' : 'none';
            runSearch();
        }

        // 3. LOGICA DI RICERCA E FILTRO
        function runSearch() {
            const query = document.getElementById('mainSearch').value.toLowerCase().trim();
            const selectedRank = document.getElementById('visualRank').value; // Legge il rango dal menu a tendina
            
            if (currentTab === 'pkmn') {
                const filtered = db.pkmn.filter(p => {
                    // Filtra per Nome, Tipo o Rango Suggerito
                    const matchNome = p.nome.toLowerCase().includes(query);
                    const matchTipo = (p.tipo || []).some(t => t.toLowerCase().includes(query));
                    const matchSuggerito = (p.rango_suggerito || "").toLowerCase().includes(query);
                    return matchNome || matchTipo || matchSuggerito;
                }).map(p => {
                    // Sovrascrive il rango attuale con quello scelto nel menu per la visualizzazione
                    return { ...p, rango_attuale: selectedRank };
                });
                renderPokemon(filtered);
            } 
            else if (currentTab === 'tech') renderTech(db.tech.filter(t => t.nome.toLowerCase().includes(query)));
            else if (currentTab === 'abil') renderAbil(db.abil.filter(a => a.nome.toLowerCase().includes(query)));
            else if (currentTab === 'max') renderMax(db.max.filter(m => m.nome.toLowerCase().includes(query)));
            else if (currentTab === 'zmove') renderZ(db.zmove.filter(z => z.nome.toLowerCase().includes(query)));
        }

        // 4. RENDERING SCHEDA POK√âMON
        function renderPokemon(list) {
            const container = document.getElementById('results');
            container.innerHTML = list.map(p => {
                // Calcolo indici per oscuramento mosse (se rango mossa > rango scelto)
                const currentRankIdx = RANGHI.indexOf(p.rango_attuale);
                
                return `
                <div class="bg-slate-900 rounded-[3rem] overflow-hidden border border-slate-800 shadow-2xl flex flex-col group hover:border-yellow-600/30 transition-all">
                    <div class="bg-slate-800/50 p-6 flex justify-between items-center border-b border-slate-800">
                        <div>
                            <span class="text-yellow-600 font-mono text-xs font-black tracking-widest">#${p.pokedex_id}</span>
                            <h2 class="text-3xl font-black text-white uppercase tracking-tighter">${p.nome}</h2>
                            <div class="flex gap-2 mt-1">
                                <span class="text-[9px] text-slate-500 font-bold uppercase">Suggerito: ${p.rango_suggerito}</span>
                            </div>
                        </div>
                        <div class="bg-slate-950 p-3 rounded-2xl border border-red-900/30 text-center min-w-[70px]">
                            <span class="block text-[8px] text-red-600 font-black uppercase">Salute</span>
                            <span class="text-2xl font-black text-white">${p.vitalita_max?.hp || 0}</span>
                        </div>
                    </div>

                    <div class="p-8">
                        <div class="flex gap-6 mb-8 items-center">
                            <img src="${p.immagine}" class="w-24 h-24 object-contain drop-shadow-2xl group-hover:scale-110 transition-transform">
                            <div class="bg-slate-800/30 p-4 rounded-2xl italic text-[11px] text-slate-400 border-l-4 border-yellow-600 flex-1">
                                "${p.descrizione}"
                            </div>
                        </div>

                        <div class="grid grid-cols-5 gap-2 mb-8">
                            ${Object.entries(p.attributi || {}).map(([attr, val]) => `
                                <div class="bg-slate-950 p-2 rounded-xl text-center border border-slate-800">
                                    <span class="text-[8px] text-slate-500 uppercase block font-black">${attr.substring(0,3)}</span>
                                    <span class="text-sm font-black text-yellow-500">${val}</span>
                                </div>
                            `).join('')}
                        </div>

                        <div class="space-y-2">
                            <span class="text-[10px] text-slate-600 font-black uppercase block border-b border-slate-800 pb-2">Apprendimento (Visualizzato come ${p.rango_attuale})</span>
                            ${(p.tecniche || []).map(m => {
                                const mRankIdx = RANGHI.indexOf(m.rango);
                                const isLocked = mRankIdx > currentRankIdx; // Mossa bloccata se rango mossa √® superiore a scelto
                                return `
                                <div class="flex justify-between items-center p-3 rounded-xl border-l-2 transition-all ${isLocked ? 'bg-slate-950/40 opacity-20 grayscale border-slate-800' : 'bg-slate-800 border-yellow-600 shadow-lg'}">
                                    <span class="text-xs ${isLocked ? 'text-slate-500' : 'text-slate-100'} font-bold">${m.nome}</span>
                                    <span class="text-[9px] ${isLocked ? 'text-slate-700' : 'text-yellow-600'} uppercase font-black">${m.rango}</span>
                                </div>`;
                            }).join('')}
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        // 5. RENDERING ALTRE CATEGORIE (Tecniche, Abilit√†, ecc.)
        function renderTech(list) {
            document.getElementById('results').innerHTML = list.map(t => `<div class="bg-slate-900 p-6 rounded-3xl border border-slate-800">
                <h3 class="text-xl font-black text-white uppercase">${t.nome}</h3>
                <p class="text-xs text-slate-400 mt-2">${t.descrizione}</p>
                <div class="mt-4 grid grid-cols-2 gap-2 text-[10px] font-bold uppercase">
                    <div class="bg-slate-950 p-2 rounded-lg text-slate-500">ACC: ${t.accuratezza}</div>
                    <div class="bg-slate-950 p-2 rounded-lg text-slate-500">DANNO: ${t.pool_danno}</div>
                </div>
            </div>`).join('');
        }

        function renderAbil(list) {
            document.getElementById('results').innerHTML = list.map(a => `<div class="bg-slate-900 p-8 rounded-[2.5rem] border-l-8 border-blue-600 shadow-xl">
                <h3 class="text-2xl font-black text-blue-500 uppercase">${a.nome}</h3>
                <p class="text-sm text-slate-300 mt-4">${a.effetto}</p>
            </div>`).join('');
        }

        function renderMax(list) {
            document.getElementById('results').innerHTML = list.map(m => `<div class="bg-slate-900 p-6 rounded-3xl border border-pink-900/30">
                <h3 class="text-xl font-black text-pink-500 uppercase">${m.nome}</h3>
                <p class="text-[10px] text-slate-400 italic mt-2">${m.descrizione}</p>
                <div class="mt-4 bg-pink-900/10 p-4 rounded-xl border-l-2 border-pink-500 text-xs text-slate-200">
                    ${m.effetti_aggiuntivi}
                </div>
            </div>`).join('');
        }

        function renderZ(list) {
            document.getElementById('results').innerHTML = list.map(z => `<div class="bg-slate-900 p-6 rounded-3xl border border-yellow-700/30 text-center">
                <h3 class="text-xl font-black text-yellow-500 uppercase">${z.nome}</h3>
                <div class="mt-4 bg-slate-950 p-4 rounded-xl text-[10px] uppercase font-bold text-slate-500">
                    CAT: ${z.categoria} | POT: ${z.potere} | ACC: ${z.accuratezza}
                </div>
            </div>`).join('');
        }

        // 6. GENERATORE CASUALE
        function randomGen() {
            const currentDb = db[currentTab];
            if(!currentDb.length) return;
            const res = [currentDb[Math.floor(Math.random()*currentDb.length)]];
            if(currentTab === 'pkmn') {
                res[0].rango_attuale = document.getElementById('visualRank').value;
                renderPokemon(res);
            }
            else if(currentTab === 'tech') renderTech(res);
            else if(currentTab === 'abil') renderAbil(res);
            else if(currentTab === 'max') renderMax(res);
            else renderZ(res);
        }

        // ESECUZIONE AL CARICAMENTO
        loadData();
    </script>
</body>
</html>
