<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Neural ProDex - Galar Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap');
        
        :root { 
            --pokedex-red: #dc2626; 
            --pokedex-dark-red: #991b1b; 
            --screen-bg: #0f172a; 
            --neon-blue: #0ea5e9; 
            --neon-yellow: #facc15; 
        }

        body { background-color: #1a1a1a; font-family: 'Rajdhani', sans-serif; color: white; padding: 20px; }
        .pokedex-logo { font-family: 'Orbitron', sans-serif; font-size: 2.5rem; font-weight: 900; color: #fff; text-shadow: 0 0 10px var(--neon-blue); text-transform: uppercase; font-style: italic; text-align: center; margin-bottom: 20px; }
        
        /* I famosi parallelogrammi inclinati dello screenshot */
        .dot { 
            width: 14px; height: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15); 
            display: inline-block; margin-right: 4px; transform: skewX(-25deg); border-radius: 1px; transition: all 0.4s ease;
        }
        .dot.filled { background: var(--neon-blue); box-shadow: 0 0 12px var(--neon-blue), inset 0 0 4px rgba(255,255,255,0.6); border: none; }

        .pokedex-frame { width: 1100px; background: var(--pokedex-red); border: 8px solid var(--pokedex-dark-red); border-radius: 20px 20px 60px 20px; padding: 25px; margin: 0 auto; box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
        .inner-screen { background: var(--screen-bg); border-radius: 15px; padding: 25px; border: 4px solid #334155; position: relative; }
        
        .label { font-family: 'Orbitron', sans-serif; font-size: 0.65rem; color: var(--neon-blue); text-transform: uppercase; letter-spacing: 1px; }
        .stat-box { background: rgba(0,0,0,0.4); border-left: 3px solid var(--neon-yellow); padding: 8px 12px; border-radius: 4px; }
        
        select, input { background: #1a1a1a !important; border: 1px solid #444 !important; color: white !important; padding: 8px !important; border-radius: 6px !important; font-size: 0.8rem !important; }
        .habitat-tag { background: #334155; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; border: 1px solid #475569; }
    </style>
</head>
<body>

    <div class="pokedex-logo">Pokérole <span class="text-red-600">Scanner</span></div>

    <div class="max-w-6xl mx-auto">
        <div class="bg-[#2d2d2d] border-2 border-[#444] rounded-xl p-4 mb-8 grid grid-cols-2 md:grid-cols-6 gap-3 items-end shadow-2xl">
            <div>
                <label class="block text-[10px] uppercase font-bold mb-1 text-gray-400 text-center">Specie</label>
                <input type="text" id="searchKey" placeholder="Nome..." class="w-full">
            </div>
            <div>
                <label class="block text-[10px] uppercase font-bold mb-1 text-gray-400 text-center">Regione</label>
                <select id="regionFilter" class="w-full">
                    <option value="all">Tutte</option>
                    <option value="Kanto">Kanto</option>
                    <option value="Johto">Johto</option>
                    <option value="Hoenn">Hoenn</option>
                    <option value="Sinnoh">Sinnoh</option>
                    <option value="Unima">Unima</option>
                    <option value="Kalos">Kalos</option>
                    <option value="Alola">Alola</option>
                    <option value="Galar">Galar</option>
                </select>
            </div>
            <div>
                <label class="block text-[10px] uppercase font-bold mb-1 text-gray-400 text-center">Tipo</label>
                <select id="typeFilter" class="w-full">
                    <option value="all">Qualsiasi</option>
                    <option value="Fuoco">Fuoco</option><option value="Acqua">Acqua</option><option value="Erba">Erba</option>
                    <option value="Elettro">Elettro</option><option value="Psico">Psico</option><option value="Lotta">Lotta</option>
                    <option value="Buio">Buio</option><option value="Acciaio">Acciaio</option><option value="Folletto">Folletto</option>
                </select>
            </div>
            <div>
                <label class="block text-[10px] uppercase font-bold mb-1 text-gray-400 text-center">Habitat</label>
                <select id="habitatFilter" class="w-full">
                    <option value="all">Tutti</option>
                    <option value="Foresta">Foresta</option><option value="Montagna">Montagna</option>
                    <option value="Mare">Mare</option><option value="Grotta">Grotta</option>
                    <option value="Città">Città</option><option value="Prateria">Prateria</option>
                </select>
            </div>
            <button onclick="generateFilteredCard()" class="bg-blue-600 hover:bg-blue-500 text-white font-black py-2 rounded-lg uppercase text-[10px] transition-all h-[38px]">Scansiona</button>
            <button id="saveBtn" onclick="openSaveModal()" class="hidden bg-green-700 hover:bg-green-600 text-white font-black py-2 rounded-lg uppercase text-[10px] transition-all h-[38px]">Cloud Save</button>
        </div>
        
        <div id="card-display"></div>
    </div>

    <div id="saveModal" class="fixed inset-0 bg-black/80 z-[9999] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-slate-900 border-2 border-cyan-500 rounded-2xl p-6 max-w-sm w-full shadow-[0_0_30px_rgba(14,165,233,0.5)]">
            <h2 class="text-xl font-black font-[Orbitron] uppercase text-white mb-4 text-center">Data Uplink</h2>
            <input type="text" id="customNickname" placeholder="ID Esemplare..." class="w-full bg-black/50 border border-cyan-500/30 p-3 rounded-lg text-cyan-400 font-bold mb-6 text-center">
            <div class="flex gap-3">
                <button onclick="closeSaveModal()" class="flex-1 px-4 py-2 bg-slate-800 text-slate-400 font-bold rounded-lg uppercase text-[10px]">Annulla</button>
                <button onclick="confirmFirebaseSave()" class="flex-1 px-4 py-2 bg-cyan-600 text-white font-black rounded-lg uppercase text-[10px] shadow-lg">Invia</button>
            </div>
        </div>
    </div>

    <script>
    // Configura con i tuoi dati reali
    const firebaseConfig = { projectId: "pokerole-app" }; 
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let pokemonData = [];
    let currentPKMN = null;

    fetch('pokemon.json').then(res => res.json()).then(data => { pokemonData = data; });

    function generateFilteredCard() {
        if (pokemonData.length === 0) return;
        
        const search = document.getElementById('searchKey').value.toLowerCase();
        const region = document.getElementById('regionFilter').value;
        const pType = document.getElementById('typeFilter').value;
        const habitat = document.getElementById('habitatFilter').value;

        let filtered = pokemonData.filter(p => {
            const matchesSearch = p.nome.toLowerCase().includes(search);
            const matchesRegion = region === 'all' || p.regione === region;
            const matchesType = pType === 'all' || p.tipo.includes(pType);
            const matchesHabitat = habitat === 'all' || (p.habitat && p.habitat.includes(habitat));
            return matchesSearch && matchesRegion && matchesType && matchesHabitat;
        });

        if (filtered.length === 0) {
            document.getElementById('card-display').innerHTML = "<div class='text-center text-red-500 font-bold p-10 bg-black/20 rounded-xl border border-red-900/30 uppercase tracking-widest'>Nessuna firma rilevata nei parametri indicati</div>";
            return;
        }

        const p = filtered[Math.floor(Math.random() * filtered.length)];

        // Logica calcolo parametri manuale Pokérole
        const attr = { forza: p.attributi.forza.base, destrezza: p.attributi.destrezza.base, vitalita: p.attributi.vitalita.base, special: p.attributi.special.base, insight: p.attributi.insight.base };
        
        // Supponiamo Skill a 1 se non definite per il calcolo base
        const combat = {
            iniziativa: attr.destrezza + 1, // + Alert
            evadere: attr.destrezza + 1,    // + Evasione
            difesa: attr.vitalita,
            difesa_speciale: attr.insight,
            parata: attr.forza + 1,         // + Clash
            parata_speciale: attr.special + 1 // + Clash
        };

        currentPKMN = { ...p, combat, attr };
        document.getElementById('saveBtn').classList.remove('hidden');
        renderUI(currentPKMN);
    }

    function renderUI(data) {
        const renderDots = (val) => Array.from({length: 5}, (_, i) => `<span class="dot ${i < val ? 'filled' : ''}"></span>`).join('');
        
        document.getElementById('card-display').innerHTML = `
        <div class="pokedex-frame animate-in fade-in duration-500">
            <div class="inner-screen">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <div class="flex gap-2 mb-2">
                            ${data.habitat ? data.habitat.map(h => `<span class="habitat-tag">${h}</span>`).join('') : ''}
                        </div>
                        <h1 class="text-5xl font-black italic uppercase font-[Orbitron] text-white tracking-tighter">${data.nome}</h1>
                        <p class="text-cyan-400 font-bold text-xs mt-1 uppercase">Sincronizzazione Area: ${data.regione}</p>
                    </div>
                    <div class="flex gap-3">
                         <div class="stat-box text-center"><div class="label text-red-500">HP</div><div class="text-2xl font-black">${data.vitalita_max.hp + data.attr.vitalita}</div></div>
                         <div class="stat-box text-center"><div class="label text-cyan-400">Tipo</div><div class="text-[10px] font-bold uppercase mt-1">${data.tipo.join(' / ')}</div></div>
                    </div>
                </div>
                
                <div class="grid grid-cols-12 gap-8">
                    <div class="col-span-4 space-y-3">
                        <div class="label opacity-50 border-b border-white/5 pb-1">Attributi Core</div>
                        <div class="flex justify-between"><span>Forza</span><div>${renderDots(data.attr.forza)}</div></div>
                        <div class="flex justify-between"><span>Destrezza</span><div>${renderDots(data.attr.destrezza)}</div></div>
                        <div class="flex justify-between"><span>Vitalità</span><div>${renderDots(data.attr.vitalita)}</div></div>
                        <div class="flex justify-between"><span>Special</span><div>${renderDots(data.attr.special)}</div></div>
                        <div class="flex justify-between"><span>Insight</span><div>${renderDots(data.attr.insight)}</div></div>
                    </div>

                    <div class="col-span-8">
                        <div class="label text-yellow-500 mb-4 border-b border-yellow-500/20 pb-1 italic">Vitals & Defense Matrix</div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="stat-box">
                                <div class="label">Iniziativa</div>
                                <div class="text-2xl font-black text-yellow-400">${data.combat.iniziativa}</div>
                                <div class="text-[8px] text-slate-500">DESTREZZA + ALLERT</div>
                            </div>
                            <div class="stat-box">
                                <div class="label">Evadere</div>
                                <div class="text-2xl font-black text-yellow-400">${data.combat.evadere}</div>
                                <div class="text-[8px] text-slate-500">DESTREZZA + EVASIONE</div>
                            </div>
                            <div class="stat-box border-l-cyan-500">
                                <div class="label">Difesa FIS | SPE</div>
                                <div class="text-2xl font-black text-white">${data.combat.difesa} | ${data.combat.difesa_speciale}</div>
                                <div class="text-[8px] text-slate-500">VITALITÀ | INSIGHT</div>
                            </div>
                            <div class="stat-box border-l-cyan-500">
                                <div class="label">Parata FIS | SPE</div>
                                <div class="text-2xl font-black text-cyan-400">${data.combat.parata} | ${data.combat.parata_speciale}</div>
                                <div class="text-[8px] text-slate-500">FORZA/SPEC + CLASH</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>`;
    }

    function openSaveModal() { document.getElementById('saveModal').classList.remove('hidden'); }
    function closeSaveModal() { document.getElementById('saveModal').classList.add('hidden'); }
    
    async function confirmFirebaseSave() {
        const nick = document.getElementById('customNickname').value;
        if(!nick) return alert("Inserisci ID");
        try {
            await db.collection("pokemon_generati").add({ ...currentPKMN, nickname: nick, timestamp: new Date() });
            alert("Sincronizzazione Completata!");
            closeSaveModal();
        } catch(e) { alert("Errore connessione."); }
    }
    </script>
</body>
</html>
