<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Neural ProDex - Advanced Combat Scanner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap');
        
        :root { 
            --pokedex-red: #dc2626; 
            --pokedex-dark-red: #991b1b; 
            --screen-bg: #0f172a; 
            --neon-blue: #0ea5e9; 
            --neon-yellow: #facc15; 
        }

        body { background-color: #1a1a1a; font-family: 'Rajdhani', sans-serif; color: white; padding: 20px; }
        .pokedex-logo { font-family: 'Orbitron', sans-serif; font-size: 2.5rem; font-weight: 900; color: #fff; text-shadow: 0 0 10px var(--neon-blue); text-transform: uppercase; font-style: italic; text-align: center; margin-bottom: 20px; }
        
        /* Grafica Parallelogrammi */
        .dot { 
            width: 14px; height: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15); 
            display: inline-block; margin-right: 4px; transform: skewX(-25deg); border-radius: 1px; transition: all 0.4s ease;
        }
        .dot.filled { background: var(--neon-blue); box-shadow: 0 0 12px var(--neon-blue), inset 0 0 4px rgba(255,255,255,0.6); border: none; }

        .pokedex-frame { width: 1100px; background: var(--pokedex-red); border: 8px solid var(--pokedex-dark-red); border-radius: 20px 20px 60px 20px; padding: 25px; margin: 0 auto; box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
        .inner-screen { background: var(--screen-bg); border-radius: 15px; padding: 25px; border: 4px solid #334155; position: relative; }
        
        .label { font-family: 'Orbitron', sans-serif; font-size: 0.65rem; color: var(--neon-blue); text-transform: uppercase; letter-spacing: 1px; }
        .stat-box { background: rgba(0,0,0,0.4); border-left: 3px solid var(--neon-yellow); padding: 6px 12px; border-radius: 4px; }
        
        .social-attr { padding: 5px 12px; border-radius: 4px; font-weight: 800; font-size: 0.75rem; text-transform: uppercase; display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .bg-tough { background-color: #fbbf24; color: #000; }
        .bg-cool { background-color: #f97316; color: #fff; }
        .bg-beauty { background-color: #3b82f6; color: #fff; }
        .bg-cute { background-color: #ec4899; color: #fff; }
        .bg-clever { background-color: #22c55e; color: #000; }
    </style>
</head>
<body>

    <div class="pokedex-logo">Pokérole <span class="text-red-600">Scanner</span></div>

    <div class="max-w-6xl mx-auto">
        <div class="bg-[#2d2d2d] border-2 border-[#444] rounded-xl p-4 mb-8 grid grid-cols-1 md:grid-cols-4 gap-4 items-end shadow-2xl">
            <div>
                <label class="block text-xs uppercase font-bold mb-1 text-gray-400">Specie</label>
                <input type="text" id="searchKey" placeholder="Cerca..." class="w-full bg-[#1a1a1a] border border-gray-600 p-2 rounded text-white text-sm">
            </div>
            <div>
                <label class="block text-xs uppercase font-bold mb-1 text-yellow-500">Rango Scanner</label>
                <select id="userRank" class="w-full bg-[#1a1a1a] border border-gray-600 p-2 rounded text-white text-sm font-bold">
                    <option value="1">Starter</option>
                    <option value="2">Beginner</option>
                    <option value="3">Amateur</option>
                    <option value="4">Ace</option>
                </select>
            </div>
            <button onclick="generateFilteredCard()" class="bg-blue-600 hover:bg-blue-500 text-white font-black py-2 rounded-lg uppercase text-xs transition-all">Analizza Area</button>
            <button id="saveBtn" onclick="openSaveModal()" class="hidden bg-green-700 hover:bg-green-600 text-white font-black py-2 rounded-lg uppercase text-xs transition-all shadow-lg">Sincronizza Cloud</button>
        </div>
        
        <div id="card-display"></div>
    </div>

    <div id="saveModal" class="fixed inset-0 bg-black/80 z-[9999] hidden flex items-center justify-center p-4">
        <div class="bg-slate-900 border-2 border-cyan-500 rounded-2xl p-6 max-w-sm w-full">
            <h2 class="text-xl font-black font-[Orbitron] uppercase text-white mb-4">Archivia Pokémon</h2>
            <input type="text" id="customNickname" placeholder="Identificativo..." class="w-full bg-black/50 border border-cyan-500/30 p-3 rounded-lg text-cyan-400 font-bold mb-6 text-center">
            <div class="flex gap-3">
                <button onclick="closeSaveModal()" class="flex-1 px-4 py-2 bg-slate-800 text-slate-400 font-bold rounded-lg uppercase text-[10px]">Annulla</button>
                <button id="confirmSaveBtn" onclick="confirmFirebaseSave()" class="flex-1 px-4 py-2 bg-cyan-600 text-white font-black rounded-lg uppercase text-[10px]">Conferma Link</button>
            </div>
        </div>
    </div>

    <script>
    // Configura Firebase con i tuoi dati
    const firebaseConfig = { projectId: "pokerole-app" }; 
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let pokemonData = [];
    let currentPKMN = null;

    fetch('pokemon.json').then(res => res.json()).then(data => { pokemonData = data; });

    function generateFilteredCard() {
        if (pokemonData.length === 0) return;
        const rankVal = parseInt(document.getElementById('userRank').value);
        const search = document.getElementById('searchKey').value.toLowerCase();
        
        let filtered = pokemonData.filter(p => p.nome.toLowerCase().includes(search));
        if (filtered.length === 0) return;

        const p = filtered[Math.floor(Math.random() * filtered.length)];

        // Logica calcolo parametri avanzati
        const attr = { forza: p.attributi.forza.base, destrezza: p.attributi.destrezza.base, vitalita: p.attributi.vitalita.base, special: p.attributi.special.base, insight: p.attributi.insight.base };
        const skills = { Allert: 1, Evasione: 1, Clash: 1 }; // Valori base esempio

        // Nuovi Parametri Richiesti
        const combat = {
            iniziativa: attr.destrezza + skills.Allert,
            evadere: attr.destrezza + skills.Evasione,
            difesa: attr.vitalita,
            difesa_speciale: attr.insight,
            parata: attr.forza + skills.Clash,
            parata_speciale: attr.special + skills.Clash
        };

        currentPKMN = { ...p, combat, attr };
        document.getElementById('saveBtn').classList.remove('hidden');
        renderUI(currentPKMN);
    }

    function renderUI(data) {
        const renderDots = (val) => Array.from({length: 5}, (_, i) => `<span class="dot ${i < val ? 'filled' : ''}"></span>`).join('');
        
        document.getElementById('card-display').innerHTML = `
        <div class="pokedex-frame animate-in fade-in duration-500">
            <div class="inner-screen">
                <h1 class="text-4xl font-black italic uppercase font-[Orbitron] text-white mb-6">${data.nome}</h1>
                
                <div class="grid grid-cols-12 gap-8">
                    <div class="col-span-4 space-y-3">
                        <div class="label opacity-50 border-b border-white/5 pb-1">Attributi</div>
                        <div class="flex justify-between"><span>Forza</span><div>${renderDots(data.attr.forza)}</div></div>
                        <div class="flex justify-between"><span>Destrezza</span><div>${renderDots(data.attr.destrezza)}</div></div>
                        <div class="flex justify-between"><span>Vitalità</span><div>${renderDots(data.attr.vitalita)}</div></div>
                        <div class="flex justify-between"><span>Special</span><div>${renderDots(data.attr.special)}</div></div>
                        <div class="flex justify-between"><span>Insight</span><div>${renderDots(data.attr.insight)}</div></div>
                    </div>

                    <div class="col-span-8">
                        <div class="label text-yellow-500 mb-4">Advanced Combat Matrix</div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="stat-box">
                                <div class="label">Iniziativa</div>
                                <div class="text-xl font-black text-yellow-400">${data.combat.iniziativa}</div>
                                <div class="text-[9px] text-slate-500">DESTREZZA + ALLERT</div>
                            </div>
                            <div class="stat-box">
                                <div class="label">Evadere</div>
                                <div class="text-xl font-black text-yellow-400">${data.combat.evadere}</div>
                                <div class="text-[9px] text-slate-500">DESTREZZA + EVASIONE</div>
                            </div>
                            <div class="stat-box">
                                <div class="label">Difesa (FIS/SPE)</div>
                                <div class="text-xl font-black text-white">${data.combat.difesa} | ${data.combat.difesa_speciale}</div>
                                <div class="text-[9px] text-slate-500">VITALITÀ | INSIGHT</div>
                            </div>
                            <div class="stat-box">
                                <div class="label">Parata (FIS/SPE)</div>
                                <div class="text-xl font-black text-cyan-400">${data.combat.parata} | ${data.combat.parata_speciale}</div>
                                <div class="text-[9px] text-slate-500">FORZA/SPEC + CLASH</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>`;
    }

    function openSaveModal() { document.getElementById('saveModal').classList.remove('hidden'); }
    function closeSaveModal() { document.getElementById('saveModal').classList.add('hidden'); }
    
    async function confirmFirebaseSave() {
        const nick = document.getElementById('customNickname').value;
        await db.collection("pokemon_generati").add({ ...currentPKMN, nickname: nick });
        alert("Archiviato!");
        closeSaveModal();
    }
    </script>
</body>
</html>
