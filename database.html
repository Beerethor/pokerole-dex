<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokeRole ProDex - Database</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@500;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- VARIABILI COLORE POKEDEX (Dalla tua immagine) --- */
        :root { 
            --pokedex-frame: #474744;    /* Grigio scuro cornice */
            --pokedex-panel: #e1e1d5;    /* Beige pannelli interni */
            --pokedex-stat-bg: #26c2d1;  /* Azzurro barre stats */
            --bg-dark: #020617; 
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-dark); 
            color: #f8fafc; 
            scroll-behavior: smooth; 
        }

        /* --- STILI SCHEDA POKEMON --- */
        .pkmn-card-pro {
            background-color: var(--pokedex-frame);
            border: 3px solid #222;
            box-shadow: 8px 8px 0px rgba(0,0,0,0.3);
            image-rendering: pixelated;
        }

        .inner-panel {
            background-color: var(--pokedex-panel);
            color: #333;
            border: 2px solid #333;
            border-radius: 12px;
        }

        /* Barre Statistiche Azzurre */
        .stat-row {
            background-color: var(--pokedex-stat-bg);
            border: 2px solid #1a8a94;
            border-radius: 15px;
            box-shadow: inset 0 2px 4px rgba(255,255,255,0.3);
        }

        /* Pallini delle Statistiche */
        .stat-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 2px;
            border: 1px solid rgba(0,0,0,0.2);
        }
        .stat-dot-fill { background: #333; }
        .stat-dot-empty { background: #fff; opacity: 0.5; }

        /* Box delle Mosse */
        .move-box {
            background-color: #a4b233; /* Verde mossa standard */
            border: 2px solid #333;
            border-radius: 15px;
            color: white;
            font-weight: 900;
        }

        /* --- COLORI TIPI --- */
        .type-fuoco { background-color: #ef4444; }
        .type-acqua { background-color: #3b82f6; }
        .type-erba { background-color: #22c55e; }
        .type-elettro { background-color: #eab308; color: black; }
        .type-normale { background-color: #9ca3af; }
        /* Aggiungi altri tipi qui seguendo lo schema... */

        .sub-active { color: #ca8a04; border-bottom: 3px solid #ca8a04; font-weight: 900; }
        .animate-pop { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes popIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="pb-12 px-4">

    <div class="max-w-6xl mx-auto">
        <header class="py-8 flex justify-between items-center">
            <a href="index.html" class="bg-slate-900 border border-slate-800 px-4 py-2 rounded-xl text-[10px] font-black uppercase hover:bg-slate-800 transition-all">⬅ Hub Centrale</a>
            <h1 class="text-3xl font-black italic tracking-tighter uppercase text-right">
                <span class="text-yellow-500">DATABASE</span> CLOUD
            </h1>
        </header>

        <nav class="flex justify-center gap-8 mb-8 text-[11px] font-black uppercase tracking-widest border-b border-slate-800 pb-4">
            <button onclick="switchSub('pkmn')" id="subPkmn" class="sub-active">Pokémon</button>
            <button onclick="switchSub('tech')" id="subTech" class="text-slate-500">Tecniche</button>
            <button onclick="switchSub('abil')" id="subAbil" class="text-slate-500">Abilità</button>
        </nav>

        <div class="bg-slate-900/50 p-4 rounded-3xl mb-10 border border-slate-800">
            <input type="text" id="mainSearch" placeholder="Cerca nome, tipo o abilità..." 
                   class="w-full bg-slate-950 border-none rounded-2xl p-4 text-white placeholder-slate-700 focus:ring-2 focus:ring-yellow-600 outline-none font-bold">
        </div>

        <div id="results" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Configurazione Firebase (Assicurati che sia uguale a index.html)
        const firebaseConfig = {
            apiKey: "AIzaSyA7Xb8BbyL9s7buH_BW0hx2exD5Tb5G-pk",
            authDomain: "pokerole-app.firebaseapp.com",
            projectId: "pokerole-app",
            storageBucket: "pokerole-app.firebasestorage.app",
            messagingSenderId: "385416519668",
            appId: "1:385416519668:web:908e12b9833f1cdc04a3a1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentData = [];
        let currentSub = 'pkmn';

        // CARICAMENTO DATI
        async function loadData() {
            const container = document.getElementById('results');
            container.innerHTML = '<div class="col-span-full text-center py-20 font-black text-yellow-600">SINCRONIZZAZIONE DATI...</div>';
            
            try {
                const snap = await getDocs(collection(db, currentSub));
                currentData = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                renderUI();
            } catch (e) {
                container.innerHTML = `<div class="text-red-500 text-center col-span-full">Errore Firebase: ${e.message}</div>`;
            }
        }

        // GENERAZIONE CARD POKEMON (Stile Pokedex)
        function createPkmnCard(p) {
            const types = Array.isArray(p.tipo) ? p.tipo : [p.tipo || 'normale'];
            const attr = p.attributi || {};
            const tecniche = p.tecniche || [];

            // Generatore pallini (max 10)
            const renderDots = (val) => {
                let dots = '';
                for (let i = 1; i <= 10; i++) {
                    dots += `<span class="stat-dot ${i <= val ? 'stat-dot-fill' : 'stat-dot-empty'}"></span>`;
                }
                return dots;
            };

            return `
            <div class="pkmn-card-pro p-4 rounded-[2rem] animate-pop flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-white font-black uppercase text-xl italic">NAME: ${p.nome}</h2>
                    <div class="flex gap-1">
                        ${types.map(t => `<span class="type-${t.toLowerCase()} px-3 py-1 rounded-full text-[9px] font-black text-white border border-white/20">${t.toUpperCase()}</span>`).join('')}
                    </div>
                </div>

                <div class="grid grid-cols-12 gap-3">
                    <div class="col-span-5 flex flex-col gap-2">
                        <div class="inner-panel p-2 aspect-square flex items-center justify-center">
                            <img src="${p.immagine || ''}" class="w-full h-full object-contain" onerror="this.src='https://via.placeholder.com/150?text=?'">
                        </div>
                        <p class="text-[9px] text-white italic leading-tight opacity-80">${p.descrizione || 'Voce di Pokédex non disponibile.'}</p>
                    </div>

                    <div class="col-span-7 flex flex-col gap-2">
                        <div class="grid grid-cols-2 gap-2">
                            <div class="inner-panel p-1 text-center">
                                <span class="text-[7px] font-black uppercase text-slate-500">Rec. Rank</span>
                                <div class="font-black text-[10px] uppercase">${p.rango || 'Starter'}</div>
                            </div>
                            <div class="inner-panel p-1 text-center">
                                <span class="text-[7px] font-black uppercase text-slate-500">Base HP</span>
                                <div class="font-black text-xs">${p.vitalita_max?.hp || 3}</div>
                            </div>
                        </div>

                        <div class="inner-panel p-2">
                            <span class="text-[7px] font-black uppercase text-slate-500 block mb-1">Abilities</span>
                            <div class="text-[10px] font-black uppercase leading-tight">${p.abilita ? p.abilita.join(', ') : 'Non listate'}</div>
                        </div>

                        <div class="bg-black/20 p-2 rounded-xl space-y-1">
                            ${['forza', 'destrezza', 'vitalita', 'special', 'insight'].map(s => `
                                <div class="stat-row flex items-center justify-between px-2 py-0.5">
                                    <span class="text-[7px] font-black uppercase text-white">${s.slice(0,3)}</span>
                                    <div class="flex items-center">${renderDots(attr[s]?.base || attr[s] || 0)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <div class="mt-4 grid grid-cols-2 gap-2">
                    ${tecniche.slice(0, 4).map(t => `
                        <div class="move-box px-3 py-1.5 flex justify-between items-center text-[9px] uppercase italic">
                            <span>${t}</span>
                            <div class="w-2 h-2 bg-white/30 rounded-full"></div>
                        </div>
                    `).join('')}
                </div>
            </div>`;
        }

        // GENERAZIONE CARD STANDARD (Per Tecniche e Abilità)
        function createStandardCard(item) {
            return `
            <div class="bg-slate-900 border border-slate-800 p-6 rounded-[2rem] animate-pop">
                <div class="flex justify-between mb-4">
                    <h3 class="text-xl font-black uppercase italic text-yellow-500">${item.nome}</h3>
                    <span class="bg-slate-800 px-3 py-1 rounded-full text-[9px] font-bold text-slate-400 uppercase">${item.tipo || 'Abilità'}</span>
                </div>
                <div class="bg-slate-950 p-4 rounded-xl border border-slate-800">
                    <p class="text-sm text-slate-300 leading-relaxed font-medium">${item.effetto || item.effetti_aggiuntivi || "Nessun dettaglio disponibile."}</p>
                </div>
                ${item.accuratezza ? `<div class="mt-3 text-[10px] font-mono text-yellow-600 font-bold uppercase">Pool Danno: ${item.pool_danno} | Accuratezza: ${item.accuratezza}</div>` : ''}
            </div>`;
        }

        // GESTORE FILTRI E RICERCA
        function renderUI() {
            const q = document.getElementById('mainSearch').value.toLowerCase();
            const filtered = currentData.filter(i => i.nome?.toLowerCase().includes(q));
            
            document.getElementById('results').innerHTML = filtered.map(i => 
                currentSub === 'pkmn' ? createPkmnCard(i) : createStandardCard(i)
            ).join('');
        }

        // CAMBIO CATEGORIA (Sub-Menu)
        window.switchSub = (s) => {
            currentSub = s;
            document.querySelectorAll('button[id^="sub"]').forEach(b => {
                b.className = b.id.toLowerCase() === 'sub'+s.toLowerCase() ? 'sub-active transition-all' : 'text-slate-500 hover:text-white transition-all';
            });
            loadData();
        };

        // Event Listeners
        document.getElementById('mainSearch').oninput = renderUI;

        // Inizializzazione al caricamento
        loadData();
    </script>
</body>
</html>
